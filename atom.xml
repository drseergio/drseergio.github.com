<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Sergey Pisarenko]]></title>
  <link href="http://drseergio.github.io/atom.xml" rel="self"/>
  <link href="http://drseergio.github.io/"/>
  <updated>2014-01-02T12:01:33+00:00</updated>
  <id>http://drseergio.github.io/</id>
  <author>
    <name><![CDATA[Sergey Pisarenko]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Investment portfolio update - December 2013]]></title>
    <link href="http://drseergio.github.io/blog/2014/01/02/investment-portfolio-update-december-2013/"/>
    <updated>2014-01-02T10:49:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2014/01/02/investment-portfolio-update-december-2013</id>
    <content type="html"><![CDATA[<h3>December&rsquo;s update</h3>

<p>The R script does not work anymore! It turns out that Yahoo has disabled URL &ldquo;charts.yahoo.com&rdquo;. However, &ldquo;icharts.finance.yahoo.com&rdquo; works fine. The problem is that the URL is hard coded into <strong>quantmod</strong> package.</p>

<p>The quick solution is to check-out latest code and build the package from source. The alternative is to wait until CRAN includes quantmod with the fix applied. Here&rsquo;s how I fixed the problem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># check-out latest quantmod code using subversion
</span><span class='line'>$ svn checkout svn://svn.r-forge.r-project.org/svnroot/quantmod/
</span><span class='line'>
</span><span class='line'># build and install the package from a local folder
</span><span class='line'>$ R CMD INSTALL quantmod/pkg/</span></code></pre></td></tr></table></div></figure>


<p>As of <strong>2013-12-31</strong> the best performing instruments are:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VBK      VBR      VTV
</span><span class='line'>16.97135 16.93180 14.93496</span></code></pre></td></tr></table></div></figure>


<p>No changes in positions.</p>

<p>We avoid investing if price is below 10 month SMA. Running through 10-month SMA check we get:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VBK  VBR  VTV
</span><span class='line'>TRUE TRUE TRUE</span></code></pre></td></tr></table></div></figure>


<p>This means portfolio should be fully invested in <strong>VBK</strong>, <strong>VBR</strong>, <strong>VTV</strong>.</p>

<p>As of <strong>2013-12-31</strong> the calculated returns for each instrument are presented below(*):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>symbol        1          3          6           12           avg
</span><span class='line'>VBK   2.50607661  7.5353908 19.5737192   38.270209   16.97134895
</span><span class='line'>VBR   2.75432672  9.9108251 18.4982354   36.563815   16.93180053
</span><span class='line'>VTV   2.09836942 10.1672916 14.3905361   33.083624   14.93495520
</span><span class='line'>VEA   1.90709046  5.8674117 18.1740856   21.800117   11.93717618
</span><span class='line'>VWO  -0.29083858  3.0819344  7.5274438   -4.944547    1.34349811
</span><span class='line'>IGOV -0.07978458  0.1900000  4.9219814   -1.368380    0.91595429
</span><span class='line'>GSG   1.35390428 -0.5867820  4.5129870   -1.829826    0.86257079
</span><span class='line'>VCIT -0.48134777  0.6450043  1.9603008   -1.897983    0.05649348
</span><span class='line'>VNQ   0.10854396 -0.8599509 -3.7136465    2.297576   -0.54186944
</span><span class='line'>VGIT -1.43194335 -1.0426540 -0.5398539   -2.687587   -1.42550967
</span><span class='line'>VGLT -2.00551133 -3.3665459 -5.4505170  -12.458972   -5.82038644
</span><span class='line'>IAU  -3.70981039 -9.3871218 -2.5854879  -28.255528  -10.98448709
</span><span class='line'>MTUM  2.68559699 11.8085305 17.7058824 -999.000000 -241.69999755</span></code></pre></td></tr></table></div></figure>


<p>* Instruments that have insufficient data are penalized with large negative returns.</p>

<h3>Resources</h3>

<ul>
<li><p><a href="http://drseergio.github.io/blog/2013/10/30/investment-portfolio-update-october-2013/">Original post explaining this strategy</a></p></li>
<li><p><a href="http://investingforaliving.wordpress.com/">Investing for a living blog</a></p></li>
<li><p><a href="https://docs.google.com/spreadsheet/ccc?key=0Ai0xPgGdCts3dEhZVUVXTFQtOEdsRUYwSmRLN3M0NHc&amp;usp=sharing#gid=1">Alternative Ivy Portfolio tracking spreadsheet</a></p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[On goals and purpose]]></title>
    <link href="http://drseergio.github.io/blog/2013/12/25/on-goals-and-purpose/"/>
    <updated>2013-12-25T19:58:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/12/25/on-goals-and-purpose</id>
    <content type="html"><![CDATA[<p>Christmas and New Year&rsquo;s Eve evoke mass hysteria to reflect and to resolve to change unlike any other time of the year. People write down goals for themselves, think about their purpose in life. Planning and goal setting are praised important even outside of the festivities.</p>

<p>I believe it&rsquo;s mostly harmless but also pointless. I look back to the moment I first embraced the Western custom of goal setting and I don&rsquo;t have much to show for it. Most of the things I have written down for myself became either unimportant or neglected. Any remarkable moments and achievements have been unexpected, spontaneous or had very little to do with the planning.</p>

<p>For one, goals are thought to be an explicit expression of one&rsquo;s desires and life values. It follows that we are fully aware of what is truly important to us and that it&rsquo;s possible to translate our priorities into conscious plans. However, I personally find a significant disconnect between conscious thought and implicit life values. It&rsquo;s difficult to crystallize the  value &ldquo;compass&rdquo; in words. Plans that come out of a rational mind can be in conflict with  governing values.</p>

<p>I have a personal illustration. I have never put the relationship with my wife as a priority or in any of the goals. However, in moments of distress I have dropped everything to take care of her. None of the goals mattered in that instant. I realize now just how important she is for me. Consciously, I did not rank the relationship high in my list of priorities and goals. But subconsciously I knew what is going to rule my behavior, especially in times of difficulty.</p>

<p>Secondly, goals have costs. It is one thing to write goals down. It is another to accept sacrifices that might be required to make them happen. I&rsquo;ve heard complaints about lines of work that are not terribly exciting. Along the complaints came aspirations for entrepreneurship and exhilarating work at emerging start-ups. I confess that the thought is contagious. I entertained it myself. But then I realized that this change has a cost and that I highly value what I already have.</p>

<p>Taken together, these two factors are responsible for destroying many naive goal setting efforts. Symptoms may differ but at the core the problem is that goals simply don&rsquo;t truly matter to the person setting them. It won&rsquo;t help to break down a goal into smaller goals or to have regular progress reviews. It just doesn&rsquo;t work that way.</p>

<p>I often recall an episode when I was about 10 years old. Two of my friends were coached by their parents to think about their lives and set goals and do all sorts of ridiculous &ldquo;self development&rdquo; exercises. I haven&rsquo;t done any of that. Yet all of the things I appreciate this very day did not come out of any priority list.</p>

<p>I believe there is a place for planning but life is not one of them. I see goals useful when an issue is well understood. Setting goals to win a specific sports competition is a technical matter. On the other hand, setting a goal to enter a competition in the first place is an entirely different thing.</p>

<p>My resolution for this NY is to stop doing useless bullshit personal goal setting crap.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Updated news sources]]></title>
    <link href="http://drseergio.github.io/blog/2013/12/14/updated-news-sources/"/>
    <updated>2013-12-14T22:02:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/12/14/updated-news-sources</id>
    <content type="html"><![CDATA[<p>I have added a couple of sites and online magazines to my subscription list. Check out the <a href="http://drseergio.github.io/news-sources">News sources</a> page for the full updated list:</p>

<ul>
<li><p><a href="http://aeon.co/">Aeon magazine</a> &ndash; Aeon Magazine is an online magazine about nature, culture and ideas.</p></li>
<li><p><a href="http://aeon.co/film/">Aeon film</a> &ndash; Aeon Film screens contemporary and classic short documentaries, exploring the intersections between nature, culture and ideas.</p></li>
<li><p><a href="http://habrahabr.ru/">Habrahabr</a> &ndash; (Russian) an online tech-oriented community/aggregator. Most of the articles are written from scratch, rather than republished. I had to spend considerable amount of time unsubscribing from different channels to bring volume down to a manageable level. But apart from that inconvenince there is lots of interesting material that is not published anywhere else.</p></li>
<li><p><a href="http://digital-photography-school.com/">Digital Photography School</a> &ndash; regular tips and guides on digital photography. I like the amount of published material. Frequent enough to be intersting to follow but not as much to become overwhelming.</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Matt and Jessica]]></title>
    <link href="http://drseergio.github.io/blog/2013/12/14/matt-and-jessica/"/>
    <updated>2013-12-14T21:58:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/12/14/matt-and-jessica</id>
    <content type="html"><![CDATA[<p>The title says it all. Matt:</p>

<p><a href="http://www.flickr.com/photos/68217075@N08/11371591986/"><img src="http://farm8.staticflickr.com/7353/11371591986_4e05a91d8f.jpg" width="500"></a></p>

<p>And Jessica:</p>

<p><a href="http://www.flickr.com/photos/68217075@N08/11371555715/"><img src="http://farm6.staticflickr.com/5516/11371555715_be88a80d8a.jpg" width="500"></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Photo report - snowshoeing in Braunwald]]></title>
    <link href="http://drseergio.github.io/blog/2013/12/14/photo-report-snowshoeing-in-braunwald/"/>
    <updated>2013-12-14T21:44:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/12/14/photo-report-snowshoeing-in-braunwald</id>
    <content type="html"><![CDATA[<p>The weather on weekends has been excellent lately. On December 8th me and my friend John went for a snowshoe hike close to Braunwald.</p>

<p>It was so warm that we took off our jackets.</p>

<p><a href="http://www.flickr.com/photos/68217075@N08/11372768584/in/set-72157638673432686/"><img src="http://farm4.staticflickr.com/3811/11372768584_33b3da0775.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/11372707455/"><img src="http://farm4.staticflickr.com/3800/11372707455_ae6d4a135e.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/11372738856/"><img src="http://farm8.staticflickr.com/7433/11372738856_7c232818c5.jpg" width="500"></a></p>

<p>The hike took about 4 hours. There&rsquo;s plenty of snow and we got our snowshoes on in about 35 minutes after beginning the trek.</p>

<h2>GPS track</h2>

<p>The route we have followed was originally created by Kathleen from <a href="http://www.meetup.com/Zurich-Swiss-Trail-Club/">Swiss Trail Club</a>.</p>

<ul>
<li><p><a href="http://drseergio.github.io/files/braunwald-snowshoe-route-part1.gpx">GPS track part 1</a></p></li>
<li><p><a href="http://drseergio.github.io/files/braunwald-snowshoe-route-part2.gpx">GPS track part 2</a></p></li>
</ul>


<h3>Links to photo albums in Flickr</h3>

<ul>
<li><a href="http://www.flickr.com/photos/68217075@N08/sets/72157638673432686/">Braundwald snowshoe hike</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Investment portfolio update - November 2013]]></title>
    <link href="http://drseergio.github.io/blog/2013/11/30/investment-portfolio-update-november-2013/"/>
    <updated>2013-11-30T09:28:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/11/30/investment-portfolio-update-november-2013</id>
    <content type="html"><![CDATA[<h3>Novembers&rsquo;s update**</h3>

<p>As of <strong>2013-11-30</strong> the best performing instruments are:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VBK      VBR      VTV
</span><span class='line'>16.93042 16.68999 14.38888</span></code></pre></td></tr></table></div></figure>


<p>Last month&rsquo;s VEA&rsquo;s position has been taken by VTV.</p>

<p>We avoid investing if price is below 10 month SMA. Running through 10-month SMA check we get:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VBK  VBR  VTV
</span><span class='line'>TRUE TRUE TRUE</span></code></pre></td></tr></table></div></figure>


<p>This means portfolio should be fully invested in <strong>VBK</strong>, <strong>VBR</strong>, <strong>VTV</strong>.</p>

<p>As of <strong>2013-11-30</strong> the calculated returns for each instrument are presented below(*):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>symbol        1          3          6           12           avg
</span><span class='line'>VBK   2.3614663  11.351201 15.5519199   38.4571033   16.93042264
</span><span class='line'>VBR   2.9323950  12.637106 13.8594008   37.3310570   16.68998975
</span><span class='line'>VTV   3.1785176  10.376667 10.8967751   33.1035702   14.38888252
</span><span class='line'>VEA   0.6609547  12.043597 12.7502056   24.6060606   12.51520442
</span><span class='line'>VWO  -0.9314545  10.879444  2.0418204    2.0669291    3.51418476
</span><span class='line'>IGOV -1.0908019   3.167282  2.6517083   -0.6808763    1.01182796
</span><span class='line'>VCIT -0.1190193   2.579147 -0.6275903   -1.5832063    0.06233274
</span><span class='line'>VGIT -0.2032838   1.672774 -0.5919003   -1.8153846   -0.23444878
</span><span class='line'>VNQ  -5.2509764   2.487874 -5.7146970    6.0042078   -0.61839801
</span><span class='line'>GSG  -0.4700721  -5.335320  3.0834145   -3.6407767   -1.59068868
</span><span class='line'>VGLT -2.3997615  -1.072670 -6.8165647  -12.6234321   -5.72810697
</span><span class='line'>IAU  -5.6031128 -10.347376 -9.8811293  -27.2781775  -13.27744894
</span><span class='line'>MTUM  3.1469761  12.179732 13.6795195 -999.0000000 -242.49844303</span></code></pre></td></tr></table></div></figure>


<p>* Instruments that have insufficient data are penalized with large negative returns.</p>

<h3>Resources</h3>

<ul>
<li><p><a href="http://drseergio.github.io/blog/2013/10/30/investment-portfolio-update-october-2013/">Original post explaining this strategy</a></p></li>
<li><p><a href="http://investingforaliving.wordpress.com/">Investing for a living blog</a></p></li>
<li><p><a href="https://docs.google.com/spreadsheet/ccc?key=0Ai0xPgGdCts3dEhZVUVXTFQtOEdsRUYwSmRLN3M0NHc&amp;usp=sharing#gid=1">Alternative Ivy Portfolio tracking spreadsheet</a></p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Enigmatic encounter]]></title>
    <link href="http://drseergio.github.io/blog/2013/11/27/enigmatic-encounter/"/>
    <updated>2013-11-27T19:57:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/11/27/enigmatic-encounter</id>
    <content type="html"><![CDATA[<p>A rising star of the division.</p>

<p><a href="http://www.flickr.com/photos/68217075@N08/11089494096/"><img src="http://farm6.staticflickr.com/5533/11089494096_116ed321d9.jpg" width="500"></a></p>

<p>And a man of thousand tales.</p>

<p><a href="http://www.flickr.com/photos/68217075@N08/11089334325/"><img src="http://farm8.staticflickr.com/7406/11089334325_3ee405ef40.jpg" width="500"></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Feeding brains]]></title>
    <link href="http://drseergio.github.io/blog/2013/11/26/feeding-brains/"/>
    <updated>2013-11-26T23:07:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/11/26/feeding-brains</id>
    <content type="html"><![CDATA[<p>Finding good sources of information is similar to finding a good diet &mdash; there is an overwhelming amount of stuff available (abundance of calories) but the utility (healthiness) of it is close to zero. Many news outlets and online media have incentives that are in conflict with providing thoughtful quality material. Media chases advertisements. In the race to achieve highest numbers of visits and ad impressions it shamelessly bombards us readers with juicy junk articles with loud headlines that shamelessly grab our attention. These articles give a quick gratification but in the long-term rob us of thoughtfulness.</p>

<p>I don&rsquo;t see an immediate solution that works for the whole society. However, that does not preclude me from avoiding the poison altogether. I intentionally avoid mainstream news. I don&rsquo;t get sucked into politics and my perception of the world is not skewed by the over representation of certain topics (such as airplane crashes). I don&rsquo;t blindly follow industry news either. There are lots of new tools, frameworks and gadgets coming out every day. It&rsquo;s impossible to learn everything so I prefer to focus on lasting ideas and skills. I can pick-up and learn ephemeral details whenever I have a specific task at hand.</p>

<p>I don&rsquo;t passively follow what is currently trending or popular. Instead, I actively seeks news through a curated list of blogs and news sources. Even with a curated list I had problems getting overwhelmed with too many items. A low signal to noise ratio takes a lot of effort to deal with.</p>

<p>From now on I will maintain an updated list of RSS feeds of blogs and websites that I am subscribed to on the <a href="http://drseergio.github.io/news-sources">News sources</a> page.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Doing it my way]]></title>
    <link href="http://drseergio.github.io/blog/2013/11/25/doing-it-my-way/"/>
    <updated>2013-11-25T21:00:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/11/25/doing-it-my-way</id>
    <content type="html"><![CDATA[<p>I had a habit of regularly reading books that are of pseudo spiritual and self help and personal growth nature. I did not follow their contents word for word but I believed I could glean useful solutions to life problems and new ways to think about reality. Recently, I came to a conclusion that I&rsquo;m not going to read such books anymore. No more productivity books. No more books on settings goals. No more books on personal growth.</p>

<p>At the core of my discontent is a realization that every person exists within a unique set of circumstances. The set of circumstances benefits from a matching set of solutions. Solutions could be anything from spiritual beliefs and value systems to productivity habits and strategies. Whenever a person observes himself succeeding in light of his actions he entrenches in conviction that his discoveries are universal.</p>

<p>I have a problem with this premise. Even in relatively similar environments every person is shaped by an intersection of local influences, actions, ideas, challenges and opportunities. I don&rsquo;t believe there are universal truths as to how to run distinctive lives. Trying to blindly follow someone else&rsquo;s beliefs is akin to dull imitation. In addition, the result is likely to be irrelevant and misplaced.</p>

<p>Most of the self help literature builds upon anecdotes &mdash; stories of highly successful people (I&rsquo;m talking about success in its widest meaning, anything between spiritual enlightenment and lucrative business empire). Authors conveniently escape talking about failures and millions of interrelated things that contribute to extraordinary outcomes. I don&rsquo;t believe it&rsquo;s possible to extract specific traits or behaviors that guarantee success. Some highly successful people are punctual. Others never gave shit about being organized yet are arguably in the same success &ldquo;league&rdquo;.</p>

<p>After all the hours spent on reading these books I&rsquo;ve embraced introspection as an alternative tool. Instead of looking outwards to find solutions I look into myself to understand what challenges I face, what is important, what brings happiness and joy. I also take a moment to appreciate what I already have.</p>

<p>See what I have done here? Exactly what the self help literature does. I&rsquo;ve imposed personal experience to provide seemingly helpful guidance. The problem is that this &ldquo;guidance&rdquo; builds upon my perception and a set of beliefs that are likely to be very different from yours. Maybe if I&rsquo;ve never read any of the self help books my stance would be different. Perhaps you should read all the self help books you can and come to the same conclusion independently.</p>

<p>If there&rsquo;s anything to take away then it&rsquo;s that it helps to be critical when reading other people&rsquo;s ideas.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Photo report - snowshoeing in Arosa]]></title>
    <link href="http://drseergio.github.io/blog/2013/11/21/photo-report-snowshoeing-in-arosa/"/>
    <updated>2013-11-21T22:29:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/11/21/photo-report-snowshoeing-in-arosa</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve been sick in and out with all kinds of cold during past several weeks. I had a lucky break last weekend and went for a snowshoe hike in Arosa, Switzerland.</p>

<p>It has been the first time I&rsquo;ve taken the snowshoes on. I had a misconception that snowshoes will let you float on the surface. They won&rsquo;t. After a couple of hours I got a hang of it and could even run. I know I&rsquo;ll be spending time outdoors so I splurged on luxurious MSR ascent snowshoes. These snowshoes have good grip &ndash; I could not slide even if I wanted to.</p>

<p>The hike itself has been rather easy and there was not much snow. However, it has been a good opportunity to get used to the snowshoes.</p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10984441523"><img src="http://farm8.staticflickr.com/7370/10984441523_6bb5bff50f.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10984229385/"><img src="http://farm6.staticflickr.com/5541/10984229385_427cedd1fd.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10984238225/"><img src="http://farm3.staticflickr.com/2810/10984238225_4afe4a194f.jpg" width="500"></a></p>

<p>We have spent the day bathing in sun above a fog that covered most of central Switzerland. On our way back there was a 2 minute opportunity to shoot the fog and the sunset before descending back into fog&rsquo;s vast but short-lived kingdom (we were changing train to bus as the regular train route was blocked by a rockfall).</p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10984454594"><img src="http://farm3.staticflickr.com/2812/10984454594_4c62b44c3d.jpg" width="500"></a></p>

<p>And this time someone took a photo of me!</p>

<p><a href="http://drseergio.github.io/images/arosa/arosa_me_01_full.jpg"><img src="http://drseergio.github.io/images/arosa/arosa_me_01_small.jpg" width="500"></a></p>

<p><img src="http://drseergio.github.io/images/arosa/arosa_me_02_small.jpg"></p>

<h3>Links to photo albums in Flickr</h3>

<p>I&rsquo;ve split the pictures into 2 thematic albums:</p>

<ul>
<li><p><a href="http://www.flickr.com/photos/68217075@N08/sets/72157637918523355/">Color photos</a></p></li>
<li><p><a href="http://www.flickr.com/photos/68217075@N08/sets/72157637919444363/">B&amp;W photos</a></p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Photo report - climbing up via ferrata Feurenwand]]></title>
    <link href="http://drseergio.github.io/blog/2013/11/03/photo-report-climbing-up-via-ferrata-feurenwand/"/>
    <updated>2013-11-03T17:37:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/11/03/photo-report-climbing-up-via-ferrata-feurenwand</id>
    <content type="html"><![CDATA[<p>Via ferratas come in different difficulty levels. Last week I&rsquo;ve done a K2 climb. Yesterday I went to Fuerenalp along with two friends and did a K4 climb. The route is a lot more exciting. Wet and slippery stones and supports presented an additional challenge.</p>

<p>According the alpine log book there were no other climbers that day.</p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10650891073/"><img src="http://farm6.staticflickr.com/5471/10650891073_9c9d90e8e9.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10650877443/"><img src="http://farm4.staticflickr.com/3667/10650877443_b435560c6f.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10649733453/"><img src="http://farm3.staticflickr.com/2865/10649733453_0f1da9acda.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10649518066/"><img src="http://farm3.staticflickr.com/2808/10649518066_327bc5537f.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10649641416/in/set-72157637265758456"><img src="http://farm4.staticflickr.com/3718/10649641416_32d76bc92d.jpg" width="500"></a></p>

<h3>Links to photo albums in Flickr</h3>

<p>I&rsquo;ve split the pictures into 2 thematic albums:</p>

<ul>
<li><p><a href="http://www.flickr.com/photos/68217075@N08/sets/72157637268821823/">Scenic photos/landscapes</a></p></li>
<li><p><a href="http://www.flickr.com/photos/68217075@N08/sets/72157637265758456/">Climbing photos</a></p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Photo report - Halloween special]]></title>
    <link href="http://drseergio.github.io/blog/2013/10/31/photo-report-halloween-special/"/>
    <updated>2013-10-31T22:18:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/10/31/photo-report-halloween-special</id>
    <content type="html"><![CDATA[<p>I had inspiration to work on something creative today. I have decided to experiment with pseudo black back-drop shots. The idea is to setup a camera so that it picks-up light from the flash only. I have produced a video and a couple of photographs. See below!</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/MG5LqIHvHDk "></iframe></div>


<p><a href="http://www.flickr.com/photos/68217075@N08/10598689133/"><img src="http://farm4.staticflickr.com/3823/10598689133_85e0a27c11.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10598445314/"><img src="http://farm4.staticflickr.com/3723/10598445314_c1f1a3a664.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10598435805/"><img src="http://farm4.staticflickr.com/3751/10598435805_bc34c720bb.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10598445536/"><img src="http://farm4.staticflickr.com/3834/10598445536_aa6e716a1e.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10598433905/"><img src="http://farm6.staticflickr.com/5550/10598433905_4ef734f132.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10598440204/"><img src="http://farm6.staticflickr.com/5543/10598440204_27104c7173.jpg" width="500"></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Investment portfolio update - October 2013]]></title>
    <link href="http://drseergio.github.io/blog/2013/10/30/investment-portfolio-update-october-2013/"/>
    <updated>2013-10-30T19:28:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/10/30/investment-portfolio-update-october-2013</id>
    <content type="html"><![CDATA[<p>Investments are a cornerstone for building passive income, increasing wealth and eventually reaching financial independence. I have passion for learning how the investment world functions and what are the different trading strategies. For the past 4 years I have mostly relied on low-cost index investments and company stock in distressed industries. In addition, I have had lots of interest towards quantitative strategies.</p>

<p>A couple of months ago I have faced a possibility of a major change in life so I have liquidated every investment into cash in preparation for it. The change never came. After reflecting upon my limited trading experience I have realized that I don&rsquo;t have a coherent strategy and I am likely to fall for the many biases and traps, namely:</p>

<ul>
<li><p>Confirmation bias. Unless I&rsquo;m doing trading (real or on paper) my brain is likely to pick-up just the positive examples of an investment strategy.</p></li>
<li><p>No single coherent idea or strategy. I have been fascinated by many tools, strategies and approaches. I have spent many hours translating ideas or systems in code that I can run to verify results. When I am chasing so many options I never arrive at anything satisfying and conclusive.</p></li>
<li><p>Not believing into one&rsquo;s own approach. Somewhat related to the previous point. Unless I&rsquo;m confident in a chosen strategy I am likely not to invest timely. This means I miss many gains and lose more often because I pull out prematurely.</p></li>
<li><p>Lack of free quality market data. Together with a friend I have written a convoluted system to buy and sell company stock around major price shocks. The system demonstrated fantastic results. However, I have realized that the price data does not include companies that went bankrupt. Such omissions make back-testing overly optimistic.</p></li>
<li><p>Lack of desire to dedicate lots of time. I won&rsquo;t last forever and I want to use the opportunity to live my life fully. There is unlimited amount of market information to understand and make use of. Onwards, I consciously choose not to spend all my spare time on investments.</p></li>
</ul>


<h3>Investment strategy of choice</h3>

<p>To overcome the concerns I have made a decision to consistently follow a strategy that I accept consciously and intellectually. The strategy is called &ldquo;Ivy Portfolio&rdquo;. There are several variations of this strategy and it boils down to holding about 5 diversified instruments when their prices are above a certain threshold. I recommend reading resources I&rsquo;ve linked to at the bottom of this post.</p>

<p>What appeals to me in this strategy is its simplicity and ability to reduce draw-downs in down markets. I will allocate 80% of my portfolio in Ivy Portfolio. The rest is going to be invested in individual companies and experimental quantitative strategies.</p>

<p>Once a month I will spend about 2-6 hours on maintaining my investment portfolio and sharing findings on this site. I will calculate and update signals for the past month, aggregate quarterly performance figures, test alternative strategies and publish results. I consciously impose a limit so that I don&rsquo;t end-up aimlessly procrastinating. I will need to set clear goals and boundaries if I want to fit in the limits.</p>

<h3>Strategy details</h3>

<p>There are several variations of the Ivy Portfolio strategy. The one that appeals to me is called &ldquo;TOP 3 GTAA 13&rdquo;. First, one needs to choose 13 instruments that represent different kinds of assets. I have made a choice of the following instruments:</p>

<ul>
<li><strong>VTV</strong> &ndash; Vanguard Value ETF (US Large Cap Value)</li>
<li><strong>MTUM</strong> &ndash; iShares MSCI USA Momentum Factor (US Large Cap Momentum)</li>
<li><strong>VBR</strong> &ndash; Vanguard Small Cap Value ETF (US Small Cap Value)</li>
<li><strong>VBK</strong> &ndash; Vanguard Small Cap Growth ETF (US Small Cap Momentum)</li>
<li><strong>VEA</strong> &ndash; Vanguard FTSE Developed Markets ETF (Foreign Developed)</li>
<li><strong>VWO</strong> &ndash; Vanguard FTSE Emerging Markets ETF (Foreign Emerging)</li>
<li><strong>VGIT</strong> &ndash; Vanguard Interm-Tm Govt Bd Idx ETF (US 10 Year Government Bonds)</li>
<li><strong>IGOV</strong> &ndash; iShares International Treasury Bond (Foreign 10 Year Government Bonds)</li>
<li><strong>VCIT</strong> &ndash; Vanguard Interm-Tm Corp Bd Idx ETF (US Corporate Bonds)</li>
<li><strong>VGLT</strong> &ndash; Vanguard Long-Term Govt Bd Idx ETF (US 30 Year Government Bonds)</li>
<li><strong>GSG</strong> &ndash; iShares S&amp;P GSCI Commodity-Indexed Trust (Commodities)</li>
<li><strong>IAU</strong> &ndash; iShares Gold Trust (Gold)</li>
<li><strong>VNQ</strong> &ndash; Vanguard REIT Index ETF (NAREIT Index)</li>
</ul>


<p>The goal is to find representative ETFs with lowest expenses and higher liquidity. On the last trading day of a month performance of each instrument is compared. 3 best performing instruments are bought. The cycle is repeated every month. Portfolio is rebalanced to maintain correct ratios.</p>

<p>It does not matter what tool you use to calculate the results. I prefer R so I have written few functions to do the calculation for me. I present the code below. I assume you have R installed along with the &ldquo;quantmod&rdquo; package. By default, quantmod relies on Yahoo! Finance as the source for price data.</p>

<figure class='code'><figcaption><span>R </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="o">&gt;</span> require<span class="p">(</span>quantmod<span class="p">)</span>
</span><span class='line'><span class="o">&gt;</span> end <span class="o">&lt;-</span> <span class="s">&#39;2013-10-30&#39;</span> <span class="c1"># specify the last trading day of the month</span>
</span><span class='line'><span class="o">&gt;</span> instruments <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&#39;VTV&#39;</span><span class="p">,</span> <span class="s">&#39;MTUM&#39;</span><span class="p">,</span> <span class="s">&#39;VBR&#39;</span><span class="p">,</span> <span class="s">&#39;VBK&#39;</span><span class="p">,</span> <span class="s">&#39;VEA&#39;</span><span class="p">,</span> <span class="s">&#39;VWO&#39;</span><span class="p">,</span> <span class="s">&#39;VGIT&#39;</span><span class="p">,</span> <span class="s">&#39;IGOV&#39;</span><span class="p">,</span> <span class="s">&#39;VCIT&#39;</span><span class="p">,</span> <span class="s">&#39;VGLT&#39;</span><span class="p">,</span> <span class="s">&#39;GSG&#39;</span><span class="p">,</span> <span class="s">&#39;IAU&#39;</span><span class="p">,</span> <span class="s">&#39;VNQ&#39;</span><span class="p">)</span> <span class="c1"># instruments we have chosen before</span>
</span><span class='line'><span class="o">&gt;</span> retFunc <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>X<span class="p">,</span> returns<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">if</span> <span class="p">(</span>X <span class="o">&gt;</span> nrow<span class="p">(</span>returns<span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">return</span><span class="p">(</span><span class="m">-999</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span> <span class="kr">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">return</span><span class="p">((</span>prod<span class="p">(</span>returns<span class="p">[</span>paste<span class="p">(</span>index<span class="p">(</span>returns<span class="p">[</span><span class="m">1</span><span class="o">+</span>nrow<span class="p">(</span>returns<span class="p">)</span><span class="o">-</span>X<span class="p">]),</span> <span class="s">&#39;::&#39;</span><span class="p">,</span> end<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)]</span><span class="m">+1</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span> <span class="o">*</span> <span class="m">100</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="c1"># function calculates return for a given X-month period, returns -999 if not enough data is available</span>
</span><span class='line'><span class="o">&gt;</span> getAvgRet <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>instrument<span class="p">,</span> end<span class="o">=</span>end<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  prices <span class="o">&lt;-</span> getSymbols<span class="p">(</span>instrument<span class="p">,</span> auto.assign<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
</span><span class='line'>  returns <span class="o">&lt;-</span> monthlyReturn<span class="p">(</span>Ad<span class="p">(</span>prices<span class="p">))[</span>paste<span class="p">(</span><span class="s">&#39;2001-01-01::&#39;</span><span class="p">,</span> end<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)]</span>
</span><span class='line'>  <span class="kr">return</span><span class="p">(</span>mean<span class="p">(</span>sapply<span class="p">(</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">12</span><span class="p">),</span> FUN<span class="o">=</span>retFunc<span class="p">,</span> returns<span class="o">=</span>returns<span class="p">)))</span>
</span><span class='line'><span class="p">}</span> <span class="c1"># function calculates an average of returns for an instrument for the last 1, 3, 6, 12 months</span>
</span><span class='line'><span class="o">&gt;</span> topInstruments <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>results<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  ndx <span class="o">&lt;-</span> order<span class="p">(</span>results<span class="p">,</span> decreasing<span class="o">=</span><span class="k-Variable">T</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span>
</span><span class='line'>  <span class="kr">return</span><span class="p">(</span>results<span class="p">[</span>ndx<span class="p">])</span>
</span><span class='line'><span class="p">}</span> <span class="c1"># function returns top 3 instruments</span>
</span><span class='line'><span class="o">&gt;</span> checkSMA <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>instrument<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  prices <span class="o">&lt;-</span> Ad<span class="p">(</span>getSymbols<span class="p">(</span>instrument<span class="p">,</span> auto.assign<span class="o">=</span><span class="kc">FALSE</span><span class="p">))</span>
</span><span class='line'>  <span class="kr">return</span><span class="p">(</span>tail<span class="p">(</span>prices<span class="p">,</span> n<span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">&gt;</span> SMA<span class="p">(</span>prices<span class="p">,</span> n<span class="o">=</span><span class="m">200</span><span class="p">))</span>
</span><span class='line'><span class="p">}</span> <span class="c1"># verifies if current instrument price is above 10-month SMA</span>
</span><span class='line'><span class="o">&gt;</span> results <span class="o">&lt;-</span> topInstruments<span class="p">(</span>sapply<span class="p">(</span>instruments<span class="p">,</span> FUN<span class="o">=</span>getAvgRet<span class="p">,</span> end<span class="o">=</span>end<span class="p">))</span>
</span><span class='line'><span class="o">&gt;</span> sapply<span class="p">(</span>names<span class="p">(</span>results<span class="p">),</span> FUN<span class="o">=</span>checkSMA<span class="p">)</span>
</span><span class='line'><span class="o">&gt;</span> retTable <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>instruments<span class="p">,</span> end<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  calcRow <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>instrument<span class="p">,</span> end<span class="o">=</span>end<span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    prices <span class="o">&lt;-</span> getSymbols<span class="p">(</span>instrument<span class="p">,</span> auto.assign<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
</span><span class='line'>    returns <span class="o">&lt;-</span> monthlyReturn<span class="p">(</span>Ad<span class="p">(</span>prices<span class="p">))[</span>paste<span class="p">(</span><span class="s">&#39;2001-01-01::&#39;</span><span class="p">,</span> end<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)]</span>
</span><span class='line'>    <span class="kr">return</span><span class="p">(</span>sapply<span class="p">(</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">12</span><span class="p">),</span> FUN<span class="o">=</span>retFunc<span class="p">,</span> returns<span class="o">=</span>returns<span class="p">))</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  tempTable <span class="o">&lt;-</span> sapply<span class="p">(</span>instruments<span class="p">,</span> FUN<span class="o">=</span>calcRow<span class="p">,</span> end<span class="o">=</span>end<span class="p">)</span>
</span><span class='line'>  tempTable <span class="o">&lt;-</span> rbind<span class="p">(</span>tempTable<span class="p">,</span> colMeans<span class="p">(</span>tempTable<span class="p">))</span>
</span><span class='line'>  tempTable <span class="o">&lt;-</span> t<span class="p">(</span>tempTable<span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  colnames<span class="p">(</span>tempTable<span class="p">)</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="s">&#39;3&#39;</span><span class="p">,</span><span class="s">&#39;6&#39;</span><span class="p">,</span><span class="s">&#39;12&#39;</span><span class="p">,</span><span class="s">&#39;avg&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="kr">return</span><span class="p">(</span>tempTable<span class="p">[</span>order<span class="p">(</span>tempTable<span class="p">[,</span><span class="m">5</span><span class="p">],</span> decreasing<span class="o">=</span><span class="k-Variable">T</span><span class="p">),])</span>
</span><span class='line'><span class="p">}</span> <span class="c1"># function to print returns for all instruments</span>
</span></code></pre></td></tr></table></div></figure>


<p>The output of the function returns names of top 3 instruments and whether they should be invested in. &ldquo;checkSMA&rdquo; will cause a failure if an instrument does not have enough past trading data.</p>

<h3>October&rsquo;s update**</h3>

<p>As of <strong>2013-10-30</strong> the best performing instruments are:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VBK      VBR      VEA
</span><span class='line'>18.03609 15.64619 13.12281</span></code></pre></td></tr></table></div></figure>


<p>We avoid investing if price is below 10 month SMA. Running through 10-month SMA check we get:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VBK  VBR  VEA
</span><span class='line'>TRUE TRUE TRUE</span></code></pre></td></tr></table></div></figure>


<p>This means portfolio should be fully invested in <strong>VBK</strong>, <strong>VBR</strong>, <strong>VEA</strong>.</p>

<p>As of <strong>2013-10-30</strong> the calculated returns for each instrument are presented below(*):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>symbol        1         3          6           12          avg
</span><span class='line'>VBK   4.1411847  8.432639 19.7628856   39.8076472   18.0360891
</span><span class='line'>VBR   5.0531915  6.004696 15.3004135   36.2264693   15.6461927
</span><span class='line'>VEA   4.1182415 10.482574  9.6302208   28.2601930   13.1228073
</span><span class='line'>VTV   5.4878922  3.939009 11.2084592   29.1578947   12.4483138
</span><span class='line'>VWO   5.5569399  9.344347 -1.0742644    5.5569399    4.8459906
</span><span class='line'>VNQ   6.0326580  2.066657 -5.0886453   13.2041969    4.0537167
</span><span class='line'>IGOV  1.8086058  3.989038  0.9658027   -0.0390282    1.6811045
</span><span class='line'>GSG  -0.8956146 -1.382913  2.5567274   -1.0789149   -0.2001789
</span><span class='line'>VCIT  1.5943419  1.789575 -3.2202809   -0.9929907   -0.2073387
</span><span class='line'>VGIT  0.7220217  1.182592 -2.0155749   -0.8651321   -0.2440233
</span><span class='line'>VGLT  1.6029963  1.208775 -9.8378091   -8.9297704   -3.9889521
</span><span class='line'>IAU   1.3188518  1.555210 -8.9895470  -22.0763723   -7.0479644
</span><span class='line'>MTUM  6.4959169  5.789086 11.5257532 -999.0000000 -243.7973111</span></code></pre></td></tr></table></div></figure>


<p>* Instruments that have insufficient data are penalized with large negative returns.</p>

<p>** Ideally the analysis must be performed at the close of the last trading day of the month, however, due to personal reasons this won&rsquo;t be possible every month. This is also why I do it today, rather than on 2013-10-31.</p>

<h3>Resources</h3>

<ul>
<li><p><a href="http://www.mebanefaber.com/2013/06/14/qtaa-update-conclustions-and-faqs/">The updated paper on Ivy Portfolio by Mebane Faber</a></p></li>
<li><p><a href="http://www.amazon.com/The-Ivy-Portfolio-Endowments-Markets/dp/1118008855">&ldquo;Ivy Portfolio&rdquo; book by Mebane Faber (amazon)</a></p></li>
<li><p><a href="http://investingforaliving.wordpress.com/">Early retiree&rsquo;s blog on investments, including strong focus on Ivy Portfolio</a></p>

<ul>
<li><p><a href="http://investingforaliving.wordpress.com/2013/09/20/an-ivy-buy-hold-portfolio-for-the-skeptical-emotional-investor/">An IVY Buy &amp; Hold Portfolio for the Skeptical &amp; Emotional Investor</a></p></li>
<li><p><a href="http://investingforaliving.wordpress.com/2013/08/05/whats-up-with-the-recent-poor-performance-of-ivy/">What’s up with the recent poor performance of IVY?</a></p></li>
<li><p><a href="http://investingforaliving.wordpress.com/2013/07/26/ivy-portfolio-summary-fees-commissions-and-taxes/">IVY portfolio summary: fees, commissions, and taxes</a></p></li>
<li><p><a href="http://investingforaliving.wordpress.com/2013/07/21/ivy-portfolio-summary-returns-risk-swrs/">IVY Portfolio Summary: returns, risk, &amp; SWRs</a></p></li>
<li><p><a href="http://investingforaliving.wordpress.com/2013/07/15/ivy-timing-model-extensions-weightings-momentum/">IVY timing model extensions – weightings &amp; momentum</a></p></li>
<li><p><a href="http://investingforaliving.wordpress.com/2013/07/13/ivy-timing-model-extensions-more-asset-classes/">IVY Timing Model Extensions – more asset classes</a></p></li>
</ul>
</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The photo curse]]></title>
    <link href="http://drseergio.github.io/blog/2013/10/27/the-photo-curse/"/>
    <updated>2013-10-27T19:51:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/10/27/the-photo-curse</id>
    <content type="html"><![CDATA[<p>I am fascinated with photography. A picture inspires, tells a story, expresses an author&rsquo;s view, captures a fleeting moment, gives an aesthetic pleasure. But there&rsquo;s a way to kill inspiration and make this art forever painful for oneself.</p>

<p>Ever since I&rsquo;ve purchased my own digital camera 4 years ago I&rsquo;ve been both blessed and burdened by photography. I have even purposefully abstained from taking any pictures for at least a couple of lengthy periods. Recently I had breakthroughs that have completely changed my attitude and brought the fun back!</p>

<p>At the root of most of my photography problems was an internal conflict between two seemingly contradicting ideas: &ldquo;enjoy the moment&rdquo; or &ldquo;take a photograph&rdquo;. One part of me badly wanted to take the camera out and put it on a tripod to take a shot. The other part was thoroughly disgusted at the sight of tourists pushing each other just to take an unremarkable shot of themselves. This other part of me reminded me not to become a mindless photo zombie machine. It&rsquo;s a common sight to see anxious visitors snap a landmark and then almost immediately move on to something else. I have seen the culmination at the Louvre museum in Paris where dozens of people are trying to take a picture of Mona Lisa. It&rsquo;s ridiculous. Why go to places at all if you don&rsquo;t genuinely marvel at things? That&rsquo;s why I often prefer to stop and really &ldquo;taste&rdquo; a sight.</p>

<p>Getting a sense of satisfaction from a photograph goes a long way. Realistically, nobody cares about my photos. There are just too many great and amazing photographers out there. Without full-time dedication it is not <em>likely</em> that anyone will become a true artist. I don&rsquo;t aspire to become one. I do photographs as a hobby and I seek satisfaction from my work regardless of how many people will ever see my photographs. But even with a very limited audience presentation is important. Everyone occasionally makes amazing photographs but the problem is that those pictures get mixed with the rest and lose their charm. For example, after a journey I end-up with 3 truly amazing shots and 40 good shots (lets say out of 500 total). It&rsquo;s better to separate pictures in sets and present amazing shots individually.</p>

<p>Then there is the feeling of being overwhelmed with options. There are unlimited number of things you can do to a photograph, not even counting limitless possibilities of composition and exposure. You can retouch a portrait, merge multiple photos together, apply various post processing effects and adjustments. Not surprisingly, this sea of options caused me almost an infinite hesitation. Should make a black-and-white picture? Or duo-tone? Or use crazy colors?</p>

<p>The problem with too many options goes beyond software. Hardware. I own two cameras, three lenses and an assortment of accessories (such as tripods, filters, etc). Carrying too much stuff gave me (head)ache for two reasons: hard to decide what lens/setup to use right now and the practical inconvenience of lugging too much stuff around. That&rsquo;s why now I mostly use a mirrorless camera with a fixed lens. For every occasion I now think ahead of what kind of shots I am after. Limits are good for fueling creativity.</p>

<p>The advent of digital cameras meant that nobody was bound by the limit of 36 frames anymore. The down-side is the actual upside. Instead of having 36 or so pictures one can easily end-up with thousands. It is a chore to go through all these pictures. Even worse, without a usable storage scheme/structure it is virtually impossible to navigate through one&rsquo;s own photos. I went through 3 iterations before I arrived at a system that works reasonably well. I&rsquo;ll explain it in a separate post.</p>

<p>Finally, it is the time pressure that exacerbates everything I have mentioned above. Going to an event or a trip with other people means that others expect to see pictures. Of course it&rsquo;s possible to ignore them and not touch the pictures for more than a year. I&rsquo;ve done that so many times! Obviously, postponing means that the backlog of pictures will grow to thousands (if not tens of thousands) of pictures. At some point there is a mounting pressure to get over the past photos before touching anything recent. It&rsquo;s a down-spiral from here. Why take pictures if I have not touched any from the past year?</p>

<p>The breakthrough that has helped me overcome problems is simple. I&rsquo;ve asked myself what kind of pictures I am taking and why. Depending on the answer I plan accordingly. I keep two major categories in my mind: photos for reporting and photos for pleasure.</p>

<p>The reporting pictures ideally take little to none processing and are mostly for documenting journeys and moments. Rules of good composition still apply but I would not plan on doing black-on-white shots or time-consuming post-processing effects. I keep these photographs as simple as possible. This allows me to share pictures most people care about quickly.</p>

<p>The other kind of photos is for joyous purposes. That includes interesting shooting angles, time-lapses, stitched panoramas, HDR shots and all kinds of fancy processing in software.</p>

<p>The important part is to separate photos into these categories as soon as possible. Then there is no pressure to finish everything at once. I find that having a separate backlog for artistic photos motivating. I return to individual photos and spend time experimenting without pressure. I feel a lot more creative and liberated that way.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Photo report - climbing up via ferrata in Pinut]]></title>
    <link href="http://drseergio.github.io/blog/2013/10/27/photo-report-climbing-up-via-ferrata-in-pinut/"/>
    <updated>2013-10-27T18:53:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/10/27/photo-report-climbing-up-via-ferrata-in-pinut</id>
    <content type="html"><![CDATA[<p>This Saturday I had a pleasure to do my first &ldquo;via ferrata&rdquo; climb in Switzerland, in Pinut to be precise. Via ferrata routes do not require climbing experience. The idea is to climb up a mountain and various obstacles while being hooked-up to a metal cable that runs along the whole route. Equipment-wise prospective climbers need a harness, a via ferrata set (a Y-shaped lanyard with an energy absorber) and a helmet.</p>

<p>The weather was phenomenally good for late October. Air temperature has risen to almost 20C! Possibly, this has been the last day of the year in Switzerland to do such a climb. I&rsquo;ll be happy to do more via ferrata climbs next year &ndash; there are hundreds of routes throughout the country.</p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10517919016/"><img src="http://farm4.staticflickr.com/3742/10517919016_c7b5b061bb.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10518125663/"><img src="http://farm3.staticflickr.com/2809/10518125663_2a9d3e6d3f.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10518192946/"><img src="http://farm8.staticflickr.com/7434/10518192946_febfdc56dc.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10518409383/"><img src="http://farm4.staticflickr.com/3684/10518409383_b93729c5e5.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10518258406/"><img src="http://farm4.staticflickr.com/3831/10518258406_c620acfb78.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10518468453/"><img src="http://farm6.staticflickr.com/5495/10518468453_588c9d71da.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10518252485/"><img src="http://farm4.staticflickr.com/3828/10518252485_c610f6590e.jpg" width="500"></a></p>

<p><a href="http://www.flickr.com/photos/68217075@N08/10518291764/"><img src="http://farm8.staticflickr.com/7391/10518291764_3daf8225d7.jpg" width="500"></a></p>

<h3>Links to photo albums in Flickr</h3>

<p>I&rsquo;ve split the pictures into 3 thematic albums:</p>

<ul>
<li><p><a href="http://www.flickr.com/photos/68217075@N08/sets/72157637014054095/">Scenic photos/landscapes</a></p></li>
<li><p><a href="http://www.flickr.com/photos/68217075@N08/sets/72157637013590136/">Climbing photos</a></p></li>
<li><p><a href="http://www.flickr.com/photos/68217075@N08/sets/72157637013702576/">B&amp;W climbing shots</a></p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[5 sold gadgets later or welcome back to Microsoft Windows]]></title>
    <link href="http://drseergio.github.io/blog/2013/10/21/5-sold-gadgets-later-or-welcome-back-to-microsoft-windows/"/>
    <updated>2013-10-21T20:31:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/10/21/5-sold-gadgets-later-or-welcome-back-to-microsoft-windows</id>
    <content type="html"><![CDATA[<p>I honestly would not anticipate writing about Microsoft Windows. Not after I have irrevocably and irreversibly switched to Linux and OSX years ago when I was studying at the university.</p>

<p>But here I am, happily typing this in Sublime2 editor on my desktop computer running nothing else but Microsoft Windows 8. Yes, the same computer that had been running Gentoo Linux a week or so ago!</p>

<!-- more -->


<p>Long story short I&rsquo;ve never intended this to happen. My goal was to reduce number of gadgets. Instead of a full-size tower PC and an Apple MacMini I wanted a single powerful machine running OSX. My idea was to buy a new motherboard with Thunderbolt ports (to connect two 27&#8221; Apple displays) and install OSX on to it. It&rsquo;s not an officially supported thing to do but I could not care less. The upcoming Apple MacPro is going to cost a fortune anyway and there is absolutely no way for me to justify such a steep price.</p>

<p><a href="http://drseergio.github.io/images/win8/3.jpg"><img src="http://drseergio.github.io/images/win8/3_s.jpg" width="500"></a></p>

<p>As you probably expect things did not go according to plan. It turned out that the motherboard I have ordered includes a Thunderbolt controller (DSL4510/4410) that is not yet supported by OSX (not even the latest Mavericks version). That left any attempts to install OSX out in the cold.</p>

<p><a href="http://drseergio.github.io/images/win8/9.jpg"><img src="http://drseergio.github.io/images/win8/9_s.jpg" width="500"></a></p>

<p>The reason I had an Apple computer in the first place was to natively run software that does not exist on Linux, such as Adobe imaging products. So I&rsquo;ve decided to install Windows and use all the same software on it. After all, the hardware I had put together has &ldquo;designed for Windows 8&rdquo; written all over it.</p>

<p>I was expecting a miserable experience. People love to bash Microsoft Windows and there are reasons for that. However, I found that the desktop experience works rather well and looks good. To be honest, I don&rsquo;t see much difference between operating systems for desktop work-loads because most of the time I use a web browser. Windows 8 does not stand in my way.</p>

<p>Every system has its quirks and Windows is no exception. I am used to quirks in all of the systems I have a pleasure to work with. The things I did not like about Windows:</p>

<ul>
<li><p>Installing drivers. In OSX almost everything is built-in. In Linux you either have a distribution with a binary kernel that includes support for almost every device or, if you&rsquo;re into it, you compile your own. Neither OSX nor Linux mandate messing with device support unless you really want to.</p></li>
<li><p>Updates. The dreadful updates plague OSX as well but not as much as Windows. I don&rsquo;t fully appreciate forced reboots and long installation times.</p></li>
<li><p>Lack of virtual desktops. Even with two 27&#8221; screens I like to have an option to switch to a different work-space. Both OSX and Linux have nailed this well. I&rsquo;ve found a program that enables virtual desktop but I don&rsquo;t know if it&rsquo;s doing its work efficiently. Perhaps I shouldn&rsquo;t care because the Intel i7 4740K is very fast and there&rsquo;s 16GB of system memory available.</p></li>
<li><p>Lack of good terminal. As a work-around I&rsquo;ve installed Console2 and Cygwin. It&rsquo;s an OK solution. I also SSH into a powerful Linux server (which acts as a <a href="http://drseergio.github.io/blog/2013/09/01/htpc-build-i-slash-m-proud-of/">HTPC</a> ) and keep a bunch of VMs around.</p></li>
<li><p>Sleep puts all windows on one monitor. In addition, the time is not immediately synced so I see the time when the computer was put to sleep.</p></li>
<li><p>Smaller behavior quirks that are solved by finding and installing utilities. For example:</p>

<ul>
<li>AltDrag to drag windows with a pointer while holding Alt pressed</li>
<li>AlwaysMouseWheel to scroll windows that are not in focus</li>
<li>TypeIt to enter German characters with a QWERTY layout</li>
<li>Dexpot for virtual desktops</li>
<li>ObjectDock for a OSX-like bar</li>
<li>ClipX as a clipboard history manager</li>
<li>NO, I do not need a &ldquo;start menu&rdquo; :D</li>
</ul>
</li>
</ul>


<p>The machine is exquisite! It&rsquo;s extremely quiet &ndash; it has only a single 120mm fan on the CPU heat-sink (I removed all the other fans). There are no extension cards and everything else is cooled passively. There&rsquo;s just one SSD and no vibrating hard disks. I can&rsquo;t tell if the computer is running or not! The Apple screens are gorgeous. I&rsquo;ve added a Logitech trackpad to do the touch gestures.</p>

<p><a href="http://drseergio.github.io/images/win8/4.jpg"><img src="http://drseergio.github.io/images/win8/4_s.jpg" width="500"></a></p>

<p>While I believe OSX might eventually support the Thunderbolt controller I don&rsquo;t plan to switch. The desktop experience is great and all the software I need works well. I&rsquo;ve sold all the gadgets, computers and computer parts I wanted through a local online auction. I feel much better now!</p>

<p>Full hardware list:</p>

<ul>
<li>Antec 1200 case (with all fans either removed or disabled)</li>
<li>Asus Z87 deluxe/dual motherboard</li>
<li>Intel 4770K</li>
<li>Noctua NH-U12P SE2 cooler</li>
<li>2x8GB RAM</li>
<li>Apple Cinema Display 27&#8221;</li>
<li>Apple Thunderbolt Screen 27&#8221;</li>
<li>Advantage Kinesis keyboard</li>
<li>Logitech M570 trackball</li>
<li>Logitech T650 multi-touch trackpad</li>
<li>Seasonic 460W passively-cooled PSU</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Why write at all]]></title>
    <link href="http://drseergio.github.io/blog/2013/10/21/why-write-at-all/"/>
    <updated>2013-10-21T18:39:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/10/21/why-write-at-all</id>
    <content type="html"><![CDATA[<p>A couple of weeks ago I have deactivated my Facebook account. I&rsquo;ve been intending to do that for months. Finally, I&rsquo;ve left the service for good.</p>

<p>Looking all the way back to 2006 I don&rsquo;t have much to show for it. You can&rsquo;t call me an addict because I&rsquo;ve never been hooked as much as people around me. Nevertheless, whenever I had cared to open Facebook&rsquo;s trendy blue interface I have been bombarded with meaningless status updates and viral junk. Numerous pointless apps and games just intensified the noise.</p>

<p>The noise itself never bothered me that much. What really bothered me is the dismal quality of what users share. It&rsquo;s seems to be a common problem with all social media. Most users simply don&rsquo;t share anything worth anyone else&rsquo;s attention. Instead of sharing genuine experiences, reflecting on one&rsquo;s life or authoring insightful writing I&rsquo;ve seen boasting, junk videos, cynicism, meaningless quotes and cryptic posts. Combined, these make their authors feel special and invite pointless discussions.</p>

<p>Facebook always made me feel bad about myself or my life. Other people&rsquo;s experiences seem just so much more authentic and full of life. It&rsquo;s basically like trashy advertising that shows you happy folks cleaning toilets with a certain kind of solvent. But instead of random folks you see whoever you had added to your Facebook &ldquo;friends&rdquo; and instead of cleaning toilets you see them doing whatever is that they were doing.</p>

<p>There are ways to read the &ldquo;stream&rdquo; without feeling insecure and unsatisfied. But it&rsquo;s hard mental and spiritual work. Despite spending considerable time to embrace mindful and present living I find Facebook to be a tough opponent. Facebook pierces through peace like a full metal jacket bullet. It&rsquo;s better to let go and give it up altogether.</p>

<p>Generally, I like the premise of a social network like Facebook. In theory it could be great. Imagine having a close circle of people who exert an effort to distill and publish their thoughts. Imagine a circle of friends who take the time to break down their adventures and experiences into stories. I am in total awe when a person cares to think and write down her thoughts instead of just slapping a bunch of photos in my face. Even if a story is not very coherent or deep.</p>

<p>I understand why Facebook, or any social media for that matter, is like that. It&rsquo;s easier to write and share junk. It&rsquo;s our brains wired for infinite satisfaction. A collection of juicy and emotional posts trigger our long-forgotten instincts just like an unhealthy sugary/fatty meal does. Nobody voluntarily wants to spend time writing or reading long posts when a &ldquo;Wall&rdquo; is bursting with sugar-high gossip, funny and disgusting media. One must willingly overcome animal desires and instincts. Choose a high-value diet &ndash; provoking and challenging information sources.</p>

<p>Not to seem like a hypocrite but I can&rsquo;t say I&rsquo;ve shared much in a meaningful way myself. I have not shared much at all. I intend to change with this personal home page. It&rsquo;s far from being a first blog of mine &ndash; there were many before it. For me the hardest part in keeping a personal page is finding a meaningful reason to share. It&rsquo;s all to easy to make a blog nothing else but a collection of the same crappy posts you see in social networks. The reason I think it&rsquo;s different this time is I feel no rush. I enjoy reflecting and writing down thoughts. I truly don&rsquo;t care if there is no value in these musings. I truly enjoy doing it right now.</p>

<p>Hopefully, by some serendipitous encounter you will find this site and share either thoughts or values or hobbies with me. Although even less likely, I hope we meet and do something fun together!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My lucky night with a FreeNAS failure]]></title>
    <link href="http://drseergio.github.io/blog/2013/09/08/my-lucky-night-with-freenas-failure/"/>
    <updated>2013-09-08T01:34:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/09/08/my-lucky-night-with-freenas-failure</id>
    <content type="html"><![CDATA[<p>It&rsquo;s 1:35am right now and something really bad has happened about 4 hours ago. First, Time Machine on my Mac Mini complained that the backup network disk became inaccessible. Then network shares have stopped responding on all computers. This means something wrong has happened with the wonderful reliable NAS server that I had built weeks ago.</p>

<p>First, I connect to the server via SSH and start poking around. Once I notice that file-system commands, such as <code>ls</code>, cause sessions to hang I become worrisome. I do a reboot hoping that solves the problem. 10 minutes pass. The server does not start.</p>

<!-- more -->


<p><img class="right" src="http://drseergio.github.io/images/chinese_monitor.jpg"></p>

<p>Once I&rsquo;ve connected a handy <a href="http://dx.com/p/8-tft-lcd-car-reverse-rear-view-color-monitor-w-vga-bnc-cable-black-149114">8&#8221; VGA monitor</a> I noticed SCSI driver related problems in the kernel logs. As it turns out, the USB drive on which FreeNAS had been installed has failed. This monitor is really handy for troubleshooting problems with servers &ndash; small, easy to carry and occupies little space in the toolbox. The picture quality is god-awful but good enough for reading terminal output.</p>

<p>I have been expecting the worst &ndash; that I would need to re-configure everything. After a quick search on the Internet I found out that FreeNAS keeps configuration in a SQLite database file on the 4th partition in <code>freenas-v1.db</code> file. A bleak hope ran through my mind. I&rsquo;ve connected the flash disk to a Linux computer and started poking around. All I needed to do was to compile UFS file-system support in kernel and then mount the partition with:</p>

<p><code>mount -r -t ufs -o ufstype=44bsd /dev/sdc4 /tmp/mm</code></p>

<p>I copied the file over and verified that it&rsquo;s not corrupted. YES! I had been stupidly postponing back-up of the configuration file. If I had to re-configure FreeNAS from scratch I would feel like a fool and waste a week worth of evenings. Now, I just need to burn the FreeNAS image to a replacement drive and I&rsquo;m all set.</p>

<p>The last step took embarassingly long time. None of the images that I had written either on Linux or Mac would boot. FreeNAS would get to an error saying <code>corrupt or invalid GPT detected.</code>. No matter what I did the outcome was the same. The solution was to delete GPT by running parted from Linux and doing <code>mklabel msdos</code>, followed by write of the disk image. I believe this problem occurred because I had previously used the drives for experimentation with Chromebook and some GPT headers apparently remained there.</p>

<p><img class="left" src="http://drseergio.github.io/images/msata.jpg"></p>

<p>Finally, I found a spare mSATA SSD drive lying around with no use (a leftover from a notebook upgrade). I also had a mSATA adapter so I&rsquo;ve put them together inside of the NAS to use as a boot device for FreeNAS. Now the NAS has 8 SATA devices (6 HDDs and 2 SSDs) maxing out all available SATA ports in the system.</p>

<p>Once I have successfully booted the server and got to the web UI and initiated import of the recovered configuration database file. Then the server rebooted twice and everything was back!</p>

<p>The machine is back online and running beautifully. I now have a backup of the configuration. In case anything goes wrong again reinstalling FreeNAS is really quick &amp; simple IFF the backup configuration file is available. I am once again pleasantly surprised at how well FreeNAS is made.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Creating dynamic task scheduler on AppEngine]]></title>
    <link href="http://drseergio.github.io/blog/2013/09/03/creating-dynamic-task-scheduler-on-appengine/"/>
    <updated>2013-09-03T21:14:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/09/03/creating-dynamic-task-scheduler-on-appengine</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://drseergio.github.io/images/app-engine.png"></p>

<p>I&rsquo;ve been working on a simple hobby project. The goal is to build an Android application which, as it turns out, requires a backend. The most important task of the backend is to perform certain things at specified times in future.</p>

<p>In this post I will explain how I&rsquo;ve designed a simple scheduler which relies on AppEngine cron, tasks and the datastore. We will make a new trivial AppEngine application that ties everything together. Although I normally prefer Python but I&rsquo;ve chosen Java for this project. I guess that&rsquo;s because I wanted some consistency with the Android counter-part that I&rsquo;m also developing.</p>

<!-- more -->


<h2>Why do we need scheduler in the first place?</h2>

<p>To implement the app that I&rsquo;m developing I must be able to send several notifications to selected users starting at a certain time within a specified interval. For example, send 5 notifications to user John with a 2 hour interval starting at 2pm. I believe such mechanism might be generally useful.</p>

<h2>Scheduler design</h2>

<p>My number one goal with the project I&rsquo;m working on is simplicity. I want to make it work. I want to learn few things. I want to end up with fewest lines of code possible. Projects can easily get out of scope and become too much to manage, especially when done out of curiosity and not with a commercial intent. This means scheduler must be as simple as possible and rely on as few parts as possible.</p>

<p>I propose to chiefly rely on the built-in AppEngine cron. Define a cron job that is executed every minute. In that cron job execute scheduled tasks. Each scheduled task has a <code>next_run_ts</code> parameter that specifies when is the next occurrence due. Whenever the cron is run it checks for all tasks that either have <code>next_run_ts</code> equal to current time or are already in the past. For every due scheduled task the cron job creates a background task to execute actual instructions.</p>

<p>The down-side of my design is that the scheduler is only accurate within couple of minutes. This is perfectly acceptable for my use-case.</p>

<h2>Create AppEngine project in Eclipse</h2>

<p>First things first, let&rsquo;s create a new AppEngine project to prototype our scheduler. I assume you have Eclipse installed and configured with Google plugin. If not, head over to a <a href="http://pisarenko.net/blog/2013/08/29/build-an-android-app-using-google-cloud-endpoints-with-oauth/">recent post I have written</a> and read the section about setting up ADT. You don&rsquo;t need ADT if you don&rsquo;t intend to write Android application but since I already have ADT there&rsquo;s no reason to mess with a separate Eclipse installation.</p>

<p>Create a new AppEngine project by clicking <code>File &gt; New &gt; Other... &gt; Google &gt; Web Application Project</code>. Choose any name you want (I&rsquo;ve chosen <code>Scheduler</code>) and specify the package name (I&rsquo;ve selected <code>net.pisarenko.backend.scheduler</code>). Untick <code>Use Google Web Toolkit</code> and <code>Generate project sample code</code> and press <code>Finish</code>.</p>

<h2>Create a test class to generate scheduled tasks</h2>

<p>In order to test our scheduler we must be able to create some tasks first. So our first goal is to create a handler which creates scheduled tasks. I&rsquo;ve called my test class <code>TestGenerator</code>:</p>

<figure class='code'><figcaption><span>TestGenerator.java </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">pisarenko</span><span class="o">.</span><span class="na">backend</span><span class="o">.</span><span class="na">scheduler</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.DatastoreService</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.DatastoreServiceFactory</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.Entity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.Key</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.KeyFactory</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;serial&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestGenerator</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">TestGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">JOB_PARENT</span> <span class="o">=</span> <span class="s">&quot;notification_job_parent&quot;</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>      <span class="c1">// set parent to ensure data consistency</span>
</span><span class='line'>      <span class="n">Key</span> <span class="n">jobKey</span> <span class="o">=</span> <span class="n">KeyFactory</span><span class="o">.</span><span class="na">createKey</span><span class="o">(</span><span class="s">&quot;NotificationJob&quot;</span><span class="o">,</span> <span class="n">JOB_PARENT</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Entity</span> <span class="n">job</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="o">(</span><span class="s">&quot;NotificationJob&quot;</span><span class="o">,</span> <span class="n">jobKey</span><span class="o">);</span>
</span><span class='line'>      <span class="n">DatastoreService</span> <span class="n">datastore</span> <span class="o">=</span> <span class="n">DatastoreServiceFactory</span><span class="o">.</span><span class="na">getDatastoreService</span><span class="o">();</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">job</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&quot;next_run_ts&quot;</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">/</span> <span class="mi">1000L</span> <span class="o">+</span> <span class="mi">10</span><span class="o">);</span>
</span><span class='line'>      <span class="n">job</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&quot;frequency&quot;</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
</span><span class='line'>      <span class="n">job</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&quot;remaining&quot;</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">datastore</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">job</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">log</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&quot;Created new job to run every 10 seconds 5 times&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>All the code does is it creates a new AppEngine data-store entity of kind <code>NotificationJob</code> when a HTTP GET request is made to this handler. Notice that I use UNIX timestamp as the specification when to run the task. I also take precautions to ensure that written data is consistent by setting a non-existent parent to the saved entity. If you&rsquo;re not familiar with AppEngine&rsquo;s data-store I highly recommend reading about <a href="https://developers.google.com/appengine/docs/java/datastore/structuring_for_strong_consistency">eventual consistency</a> as AppEngine data-store is very different from RDBMS and you must have the right mindset when designing storage for your system.</p>

<p>The intent of the test scheduled task is to execute 6 times within 10 second interval and start in 10 seconds from the moment the handler is called.</p>

<p>Notice that I&rsquo;m using 10 second interval. As you remember, AppEngine cron executes once a minute. This means that the resolution of the cron is not sufficient for running our test task. AppEngine would likely execute all 6 occurrences at the same time. However, we will be using the development server and cron jobs are not executed automatically. We will be acting as a cron ourselves. I will manually access the test handler more often than every 10 seconds for testing purposes.</p>

<p>Let&rsquo;s register our handler at <code>/test</code> by modifying the <code>web.xml</code> file under <code>war/WEB-INF/</code> in the project structure:</p>

<figure class='code'><figcaption><span>web.xml </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>...
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;servlet&gt;</span>
</span><span class='line'>      <span class="nt">&lt;servlet-name&gt;</span>test<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;servlet-class&gt;</span>net.pisarenko.backend.scheduler.TestGenerator<span class="nt">&lt;/servlet-class&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/servlet&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;servlet-mapping&gt;</span>
</span><span class='line'>      <span class="nt">&lt;servlet-name&gt;</span>test<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;url-pattern&gt;</span>/test<span class="nt">&lt;/url-pattern&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/servlet-mapping&gt;</span>
</span><span class='line'>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>For testing/development/debugging purposes I&rsquo;ve put a log statement. Let&rsquo;s try our generator. Run the project by pressing Ctrl+F11. By default, the development server starts at <code>http://127.0.0.1:8888</code> so our handler is accessible at <code>http://127.0.0.1:8888/test</code>.</p>

<p>Access the test handler and check the output of console in Eclipse. You should see something like this:</p>

<p><img src="http://drseergio.github.io/images/scheduler/console.png"></p>

<p>Our test scheduled task has been saved! Now let&rsquo;s finish this off with the actual task handler.</p>

<h2>Configure cron and the scheduled task handler</h2>

<p>To run our scheduler loop every minute using AppEngine&rsquo;s cron we must create a <code>cron.xml</code> config file in <code>war/WEB-INF</code>:</p>

<figure class='code'><figcaption><span>cron.xml </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;cronentries&gt;</span>
</span><span class='line'>  <span class="nt">&lt;cron&gt;</span>
</span><span class='line'>    <span class="nt">&lt;url&gt;</span>/cron<span class="nt">&lt;/url&gt;</span>
</span><span class='line'>    <span class="nt">&lt;description&gt;</span>Send pending notifications<span class="nt">&lt;/description&gt;</span>
</span><span class='line'>    <span class="nt">&lt;schedule&gt;</span>every 1 minute<span class="nt">&lt;/schedule&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/cron&gt;</span>
</span><span class='line'><span class="nt">&lt;/cronentries&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Effectively, this will execute <code>/cron</code> endpoint every minute. Note that development server will not run cron so we will manually trigger it through the browser by accessing <code>http://127.0.0.1:8888/cron</code>.</p>

<p>Now let&rsquo;s write the code behind the <code>/cron</code> endpoint. The code will check current time, retrieve all scheduled tasks which have next run either in the past or right now and execute them. If the task is supposed to be run several times we will reduce the remaining run counter, calculate the next execution time and save the changes. If the task has no more runs we delete the entity from the data-store:</p>

<figure class='code'><figcaption><span>NotificationScheduler.java </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">pisarenko</span><span class="o">.</span><span class="na">backend</span><span class="o">.</span><span class="na">scheduler</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.DatastoreService</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.DatastoreServiceFactory</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.Entity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.Key</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.KeyFactory</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.PreparedQuery</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.Query</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.Query.FilterPredicate</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.datastore.Query.FilterOperator</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.taskqueue.Queue</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.google.appengine.api.taskqueue.QueueFactory</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">appengine</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">taskqueue</span><span class="o">.</span><span class="na">TaskOptions</span><span class="o">.</span><span class="na">Builder</span><span class="o">.*;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;serial&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NotificationScheduler</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">NotificationScheduler</span><span class="o">.</span><span class="na">class</span>
</span><span class='line'>            <span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
</span><span class='line'>            <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&quot;Running cron loop&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="kt">long</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">/</span> <span class="mi">1000L</span><span class="o">;</span>
</span><span class='line'>        <span class="n">log</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&quot;Current time: &quot;</span> <span class="o">+</span> <span class="n">currentTime</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">DatastoreService</span> <span class="n">datastore</span> <span class="o">=</span> <span class="n">DatastoreServiceFactory</span>
</span><span class='line'>                <span class="o">.</span><span class="na">getDatastoreService</span><span class="o">();</span>
</span><span class='line'>        <span class="n">Key</span> <span class="n">jobKey</span> <span class="o">=</span> <span class="n">KeyFactory</span><span class="o">.</span><span class="na">createKey</span><span class="o">(</span><span class="s">&quot;NotificationJob&quot;</span><span class="o">,</span>
</span><span class='line'>                <span class="n">TestGenerator</span><span class="o">.</span><span class="na">JOB_PARENT</span><span class="o">);</span>
</span><span class='line'>        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Query</span><span class="o">(</span><span class="s">&quot;NotificationJob&quot;</span><span class="o">,</span> <span class="n">jobKey</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">setAncestor</span><span class="o">(</span><span class="n">jobKey</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">setFilter</span><span class="o">(</span>
</span><span class='line'>                        <span class="k">new</span> <span class="nf">FilterPredicate</span><span class="o">(</span><span class="s">&quot;next_run_ts&quot;</span><span class="o">,</span>
</span><span class='line'>                                <span class="n">FilterOperator</span><span class="o">.</span><span class="na">LESS_THAN_OR_EQUAL</span><span class="o">,</span> <span class="n">currentTime</span><span class="o">));</span>
</span><span class='line'>        <span class="n">PreparedQuery</span> <span class="n">pq</span> <span class="o">=</span> <span class="n">datastore</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">Entity</span> <span class="n">job</span> <span class="o">:</span> <span class="n">pq</span><span class="o">.</span><span class="na">asIterable</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">processJob</span><span class="o">(</span><span class="n">job</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">processJob</span><span class="o">(</span><span class="n">Entity</span> <span class="n">job</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Queue</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">QueueFactory</span><span class="o">.</span><span class="na">getDefaultQueue</span><span class="o">();</span>
</span><span class='line'>        <span class="n">queue</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">withUrl</span><span class="o">(</span><span class="s">&quot;/sender&quot;</span><span class="o">).</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;job_id&quot;</span><span class="o">,</span> <span class="s">&quot;job_id&quot;</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">DatastoreService</span> <span class="n">datastore</span> <span class="o">=</span> <span class="n">DatastoreServiceFactory</span>
</span><span class='line'>                <span class="o">.</span><span class="na">getDatastoreService</span><span class="o">();</span>
</span><span class='line'>      <span class="n">job</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&quot;remaining&quot;</span><span class="o">,</span> <span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">job</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;remaining&quot;</span><span class="o">))</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">if</span> <span class="o">((</span><span class="n">Long</span><span class="o">)</span><span class="n">job</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;remaining&quot;</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">datastore</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">job</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">job</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&quot;next_run_ts&quot;</span><span class="o">,</span>
</span><span class='line'>              <span class="o">((</span><span class="n">Long</span><span class="o">)</span><span class="n">job</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;next_run_ts&quot;</span><span class="o">))</span> <span class="o">+</span> <span class="o">((</span><span class="n">Long</span><span class="o">)</span><span class="n">job</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;frequency&quot;</span><span class="o">)));</span>
</span><span class='line'>          <span class="n">datastore</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">job</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The handler executes a query against the data-store to retrieve due scheduled tasks. Note that it uses ancestor query to ensure that return values are consistent. Then we iterate through retrieved scheduled tasks and execute <code>processJob</code> method. The <code>processJob</code> introduces AppEngine default queue which we use for executing our scheduled tasks in the background.</p>

<p>Update <code>web.xml</code> for the new handler:</p>

<figure class='code'><figcaption><span>web.xml </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>...
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;servlet&gt;</span>
</span><span class='line'>      <span class="nt">&lt;servlet-name&gt;</span>cron<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;servlet-class&gt;</span>net.pisarenko.backend.scheduler.NotificationScheduler<span class="nt">&lt;/servlet-class&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/servlet&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;servlet-mapping&gt;</span>
</span><span class='line'>      <span class="nt">&lt;servlet-name&gt;</span>cron<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;url-pattern&gt;</span>/cron<span class="nt">&lt;/url-pattern&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/servlet-mapping&gt;</span>
</span><span class='line'>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>At this point the code won&rsquo;t work because the <code>processJob</code> method is creating queue tasks (not to confuse with our custom scheduled tasks) to be run in the background. Let&rsquo;s fix that!</p>

<h2>Use the default AppEngine queue for executing scheduled tasks</h2>

<p>AppEngine provides functionality to execute code in the background. The easiest way is to use the default push queue. Basically, you tell the default push queue what endpoint should handle the task and AppEngine will execute that endpoint in background. You can also provide parameters that will be populated as HTTP request parameters. No additional configuration is needed, simply instantiate the queue as in our test code.</p>

<p>In the code above we call endpoint <code>/sender</code> with parameter <code>job_id</code> whose value is always <code>job_id</code>. Obviously, this is not a very useful parameter as it stands. However, in future I will change this parameter to provide enough information to the background task handler to carry out execution of the task. For example, the parameter could provide a key to an entity that contains users which should be notified.</p>

<p>The code for the <code>/sender</code> handler:</p>

<figure class='code'><figcaption><span>NotificationSender.java </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">pisarenko</span><span class="o">.</span><span class="na">backend</span><span class="o">.</span><span class="na">scheduler</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;serial&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NotificationSender</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">NotificationSender</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&quot;EXECUTING TASK FROM QUEUE &quot;</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;job_id&quot;</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see, it does not do much but it provides the almighty log statement which we will use to confirm that our code is working as we want it to. Finally, update <code>web.xml</code> with <code>/sender</code>:</p>

<figure class='code'><figcaption><span>web.xml </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>...
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;servlet&gt;</span>
</span><span class='line'>        <span class="nt">&lt;servlet-name&gt;</span>sender<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>        <span class="nt">&lt;servlet-class&gt;</span>net.pisarenko.backend.scheduler.NotificationSender<span class="nt">&lt;/servlet-class&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/servlet&gt;</span>
</span><span class='line'>  
</span><span class='line'>    <span class="nt">&lt;servlet-mapping&gt;</span>
</span><span class='line'>        <span class="nt">&lt;servlet-name&gt;</span>sender<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>        <span class="nt">&lt;url-pattern&gt;</span>/sender<span class="nt">&lt;/url-pattern&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/servlet-mapping&gt;</span>
</span><span class='line'>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<h2>Final run</h2>

<p>Run the application from Eclipse and open your browser. First, access <code>http://127.0.0.1:8888/cron</code> and observe that <code>EXECUTING TASK FROM QUEUE job_id</code> is displayed in console output. By accessing <code>/cron</code> you&rsquo;re acting as a manual cron. Remember when we ran <code>/test</code>? Exactly, this is why our cron handler is now executing those long due tasks! Refresh the page several times to make sure that all 6 occurrences are run.</p>

<p>Then, run <code>/test</code> to create another test scheduled task and quickly access <code>/cron</code> handler again. If you refresh the browser window often enough you will observe that the scheduled task is executed only when 10 seconds have elapsed since the last execution. Sweet, our scheduler is working!</p>

<p>As a next step, experiment with the test generator and try the code in production AppEngine. As for myself, I&rsquo;m going to integrate this piece into the project I&rsquo;m working on. I prefer to build applications by prototyping separate pieces one at a time. This way I at least have an idea of what to expect from each comopnent and know how to integrate it into the bigger design.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HTPC build I'm proud of]]></title>
    <link href="http://drseergio.github.io/blog/2013/09/01/htpc-build-i-slash-m-proud-of/"/>
    <updated>2013-09-01T17:38:00+00:00</updated>
    <id>http://drseergio.github.io/blog/2013/09/01/htpc-build-i-slash-m-proud-of</id>
    <content type="html"><![CDATA[<p>If you follow what I write here and on <a href="http://grow-slowly.com">http://grow-slowly.com</a> you will notice that I am somewhat obsessed with reducing the number of possessions in my life. This directly contradicts another, though negative, characteristic of mine &ndash; to get more gadgets and possessions.</p>

<p>Recently, I have had a lot of good progress on challenging the negative trait. Not only I&rsquo;ve been more successful on overcoming the purchasing obsession but I&rsquo;ve also found ways to enjoy more and get creative at reusing what I already have.</p>

<p>One of my recent projects was to combine several devices into one. I&rsquo;ve got rid of Sony Playstation 3 and merged 2 computers together. Here&rsquo;s the end-result:</p>

<p><a href="http://drseergio.github.io/images/htpc/2.jpg"><img src="http://drseergio.github.io/images/htpc/2.jpg" width="500"></a></p>

<!-- more -->


<p>Just one neat-looking HTPC (home theater personal computer) that fits into the living room! Why did I have 3 devices in the first place? Well, I&rsquo;ve obviously used Sony Playstation 3 for playing games. I&rsquo;m not an obsessive gamer but I do enjoy certain games once in a while. I appreciate the fact that once you own a console no hardware upgrades are necessary. The down-side is that the graphics quality is lower than on PCs as the technology advances and the console stays the same.</p>

<p>Second, I had a server running gentoo Linux with relatively high computational power &ndash; modern i7 Intel processor, 32GB RAM and a pair of SSD drives. I&rsquo;ve used the machine for doing relatively-taxing statistical calculations, VMs and later ran a bittorrent downloader.</p>

<p>Third, I had an HTPC to watch movies and listen music. I don&rsquo;t like an idea of using an off-the-shelf media player. New formats get released every now and then and some videos are available online on certain sites only. Chances are that sooner or later there will be a video that the off-the-shelf box can&rsquo;t play. Having a full-blown PC has full flexibility as I can always install newer software or use a standard desktop browser to open any streaming site. Although I actively use XBMC for great viewing experience I&rsquo;ve intentionally left the full KDE desktop experience as I don&rsquo;t want to mask the functionality of a computer. By the way, the HTPC had been powered by an Asus E350 board (similar to what I currently use in <a href="http://pisarenko.net/blog/2013/08/28/impressions-from-freenas/">my NAS build</a>) and a passively cooled nVidia Geforce 610. Couple that together with a passive Seasonic power supply and you get a completely quiet computer!</p>

<p>I&rsquo;ve realized that I was wasting resources. I can play games on a PC (apart from few PS3 exclusives) so I don&rsquo;t really need a PS3. The server is already running 24x7 so why can&rsquo;t I use it as HTPC? With that idea in mind I&rsquo;ve decided to merge 2 computers together and sell the PS3 to a colleague.</p>

<p>I admit the conversion was far from frugal as I had to purchase a powerful graphics card to allow gaming. In addition, the cooling system I had in the server would not fit in the relatively compact Antec Fusion Remote case (Corsair H100). Finally, the power supply I had was not powerful enough.</p>

<p>The final spec list I arrived at:</p>

<ul>
<li><p>Antec Fusion Remote case (re-used from existing HTPC)</p></li>
<li><p>Asus ROG IV Gene mATX motherboard (re-used from the server)</p></li>
<li><p>Intel i7 i3930K CPU (re-used from the server)</p></li>
<li><p>32GB RAM (re-used from the server)</p></li>
<li><p>2x60GB Intel SSD (re-used from the server)</p></li>
<li><p>750W Seasonic X series PSU (bought)</p></li>
<li><p>1x60GB SSD (bought, for installing Windows 7 on it)</p></li>
<li><p>2xnVidia Zotac GeForce 660 in SLI mode (bought, to be able to play games)</p></li>
<li><p>Windows 7 license (bought, to be able to play games)</p></li>
<li><p>LG BluRay writer (bought, to install Windows and have at least 1 optical drive at home)</p></li>
<li><p>2x120mm NoiseBlocker case fans (re-used from the server)</p></li>
<li><p>Noctua NH-U12P SE2 CPU cooler (bought)</p></li>
</ul>


<p>The unused internals from the existing server and HTPC were either sold or given away to those who need them. Nothing was thrown away.</p>

<p>The final under-the-hood view of the build:</p>

<p><a href="http://drseergio.github.io/images/htpc/4.jpg"><img src="http://drseergio.github.io/images/htpc/4.jpg" width="500"></a></p>

<p>I&rsquo;ve installed Windows 7 on a separate SSD. When I want to play games I have to reboot the machine into Windows 7. The down-side is that the server is temporarily unavailable. It&rsquo;s an acceptable solution for my purposes as I&rsquo;m the only user of the server and I don&rsquo;t actively need the server while I&rsquo;m playing. In addition, I play only a couple of hours every other week.</p>

<p>I have been a little worried that I would not be able to fit all the hardware in the case but everything got in surprisingly well. It&rsquo;s not possible to fit in a 7-generation nVidia as the new cards are considerably longer (ca 30 cm vs 19cm GeForce 660). I hope future GPU generations will reverse the trend.</p>

<p>Another concern is noise. I was pleasantly surprised that the end result is not loud. At least not when it&rsquo;s running as a server. It makes a lot of noise when I play but then the issue is not relevant as the sound from speakers is much louder. I can heartily recommend Zotac&rsquo;s graphics cards as they are quiet unless you&rsquo;re gaming. The 750W PSU from Seasonic is similar as it has a fan that turns on only under heavy load. The Noctua CPU cooler is also quiet.</p>

<p>Now I can play games, watch movies and perform computational tasks all from one machine. And most importantly it fits well within the interior:</p>

<p><a href="http://drseergio.github.io/images/htpc/3.jpg"><img src="http://drseergio.github.io/images/htpc/3.jpg" width="300"></a> <a href="http://drseergio.github.io/images/htpc/1.jpg"><img src="http://drseergio.github.io/images/htpc/1.jpg" width="300"></a></p>

<p>It is clear to me that in future this machine will get obsolete as newer games require faster hardware. This means that I&rsquo;ll likely need to upgrade graphics cards. The issue is that newer cards are also likely to be long so I&rsquo;ll need a different case. When that happens I have my eyes on Antec Fusion Remote Max. The &ldquo;Max&rdquo; version should have enough space.</p>

<p>I&rsquo;m glad I got rid of a few things. I wasn&rsquo;t very frugal at it but at least <a href="http://grow-slowly.com/2013/08/24/an-update-on-my-frugality-efforts/">I&rsquo;m getting better at it</a>!</p>
]]></content>
  </entry>
  
</feed>

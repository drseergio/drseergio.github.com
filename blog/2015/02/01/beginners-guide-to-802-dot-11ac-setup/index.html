<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Beginners guide to a custom 802.11ac setup</title>
  <meta property="og:title" content="Beginners guide to a custom 802.11ac setup" />
  <meta name="twitter:title" content="Beginners guide to a custom 802.11ac setup" />
  <meta name="description" content="



About 3 months ago I had nothing better to do so I decided to replace an off-the-shelf Linksys E4200 wireless router with a custom build running an unrestricted O/S. I admit E4200 worked reliably through the years on stock firmware but I never felt comfortable with the privacy and network vulnerability aspects of commonly sold devices. And I find third-party router firmwares too complicated to fully comprehend and tweak. There&rsquo;s simply too much configuration becauase it needs to satisfy many use cases.
">
  <meta property="og:description" content="



About 3 months ago I had nothing better to do so I decided to replace an off-the-shelf Linksys E4200 wireless router with a custom build running an unrestricted O/S. I admit E4200 worked reliably through the years on stock firmware but I never felt comfortable with the privacy and network vulnerability aspects of commonly sold devices. And I find third-party router firmwares too complicated to fully comprehend and tweak. There&rsquo;s simply too much configuration becauase it needs to satisfy many use cases.
">
  <meta name="twitter:description" content="



About 3 months ago I had nothing better to do so I decided to replace an off-the-shelf Linksys E4200 wireless router with a custom build running an unrestricted O/S. I admit E4200 worked reliably â€¦">
  <meta name="author" content="Sergey Pisarenko"/>
  <link href='http://pisarenko.net/images/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="http://pisarenko.net/images/sergey_pisarenko_logo.jpg" />
  <meta name="twitter:image" content="http://pisarenko.net/images/sergey_pisarenko_logo.jpg" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="http://pisarenko.net/blog/2015/02/01/beginners-guide-to-802-dot-11ac-setup/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Sergey Pisarenko" />

  <meta name="generator" content="Hugo 0.38" />
  <link rel="canonical" href="http://pisarenko.net/blog/2015/02/01/beginners-guide-to-802-dot-11ac-setup/" />
  <link rel="alternate" href="http://pisarenko.net/index.xml" type="application/rss+xml" title="Sergey Pisarenko">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://pisarenko.net/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="http://pisarenko.net/css/pygment_highlights.css" />
  <link rel="stylesheet" href="http://pisarenko.net/css/highlight.min.css" />
</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://pisarenko.net/">Sergey Pisarenko</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="All" href="/">All</a>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Pro</a>
              <div class="navlinks-children">
                
                  <a href="/categories/pro">Posts </a>
                
                  <a href="https://github.com/pisarenko-net">Github</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">Personal</a>
              <div class="navlinks-children">
                
                  <a href="/categories/personal">Posts</a>
                
                  <a href="http://www.flickr.com/photos/68217075@N08/">Photos</a>
                
                  <a href="https://www.strava.com/athletes/6411230">Rides/runs</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="About" href="/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Archives" href="/post">Archives</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Sergey Pisarenko" href="http://pisarenko.net/">
            <img class="avatar-img" src="http://pisarenko.net/images/sergey_pisarenko_logo.jpg" alt="Sergey Pisarenko" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>Beginners guide to a custom 802.11ac setup</h1>
                
                
                  <span class="post-meta">
  Posted on February 1, 2015
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p><a href="/images/80211ac.jpg"><img src="/images/80211ac.jpg" class="right" width="240" />

</a></p>

<p>About 3 months ago I had nothing better to do so I decided to replace an off-the-shelf Linksys E4200 wireless router with a custom build running an unrestricted O/S. I admit E4200 worked reliably through the years on stock firmware but I never felt comfortable with the privacy and network vulnerability aspects of commonly sold devices. And I find third-party router firmwares too complicated to fully comprehend and tweak. There&rsquo;s simply too much configuration becauase it needs to satisfy many use cases.
</p>

<p>I&rsquo;ve never documented that assembly and installation experience so when a new opportunity to build a 802.11ac access point using very similar hardware came about I jumped right at it.</p>

<p>In general, there&rsquo;s nothing particularly novel about buying standard x86 hardware, putting together a couple of components and then installing Linux on it. But with wireless networking, especially 802.11n and 802.11ac, there&rsquo;s numerous configuration options available. Without tuning and verification a 802.11ac/802.11n setup might run as fast as 802.11g which isn&rsquo;t any fast at all. After going through these builds I&rsquo;m hesitant to take wireless configuration for granted, especially when just buying SOHO grade equipment.</p>

<h2 id="the-why">The &ldquo;why&rdquo;</h2>

<p>Why do a DIY router build? There&rsquo;s the privacy and vulnerability aspects that I had already mentioned. Large manufacturers discontinue updating their SOHO devices within years of release. In light of critical vulnerabilities found just in core Linux libraries it is not an assuring situation.</p>

<p>But the real reason that pushed me to change are the unnecessary features and small things that can&rsquo;t be configured on most SOHO routers. For example, there are often built-in DNS servers but most of the devices I&rsquo;ve used don&rsquo;t let the user to set the default search domain. Instead, these routers push the search domain from ISP. It&rsquo;s a minor detail but there are plenty such annoyances.</p>

<p>The unneeded features just scream additional attack vectors to me. I prefer to have a list of iptables rules that fits on a screen because I&rsquo;m not running an ISP or a data-center at home. I can isolate untrusted devices and let them connect to the Internet only without having any access to other hosts in the network.</p>

<h2 id="bits-and-parts">Bits and parts</h2>

<p>I have built the router based on <a href="http://www.pcengines.ch/apu.htm">PC Engines APU x86 board</a>. It has a relatively powerful CPU, PCI express bus, mSATA, SIM slot, USB, serial port and other extras. I like the passive cooling and low power consumption. I would not want a router based on old PC desktop hardware because that takes up a lot of space, burns lots of power and makes noise.</p>

<p><a href="https://www.flickr.com/photos/tentaclephotos/16415575152/"><img src="https://farm9.staticflickr.com/8612/16415575152_0ba93b669e_c.jpg" width="800" />

</a></p>

<p>Total cost of parts for dual-radio 802.11n router came at around 200$. The price for the new 802.11ac access point is higher at around 260$. That&rsquo;s because the 802.11ac radio. In total, the materials don&rsquo;t cost significantly more than off-the-shelf stuff.</p>

<p><a href="https://www.flickr.com/photos/tentaclephotos/15794024864/"><img src="https://farm9.staticflickr.com/8671/15794024864_8b2a475c9d_n.jpg" width="240" />

</a></p>

<p>Since I&rsquo;m living in Switzerland and PC Engines is a Swiss company I had one more reason to order from them. I&rsquo;m impressed with the shipping speed and invoice-based payment.</p>

<p>The list of parts for the 802.11ac build:</p>

<ul>
<li>SSD M-Sata 16GB MLC Phison</li>
<li>APU.1D system board 2GB</li>
<li>Enclosure 3 LAN, black</li>
<li>AC adapter 12V 2A</li>
<li>3x Antenna reverse SMA dual band</li>
<li>3x Cable MMCX -&gt; reverse SMA</li>
<li>SATA data + power cable (for a hack, read further)</li>
<li>Mini PCI Express Extender Extension FFC Cable</li>
<li>COMPEX WLE900V5-23 miniPCIe module, AR9880, 802.11ac, 3*3MIMO</li>
</ul>

<p>Unlike with the 802.11n router build I had to do a couple of simple hacks to put it all together. The Compex 802.11ac radio is wide so it does not fit in a standard miniPCIe slot. I had to order an extension cable from eBay and use double-sided adhesive tape to put the radio on the inside &ldquo;ceiling&rdquo; of the enclosure. Then, I had to drill a hole in the enclosure to put an additional 3rd antenna for achieving 3*3MIMO. Finally, Compex radio requires external 5V supply. Luckily, the board has pins for powering a SATA drive. I&rsquo;ve cut a <a href="http://www.pcengines.ch/satacab1.htm">SATA data+power cable</a> and used the power connector to connect 5V positive to the radio.</p>

<p>You can see the semi-assembled board on the photo:</p>

<p><a href="https://www.flickr.com/photos/tentaclephotos/16414742291/"><img src="https://farm8.staticflickr.com/7311/16414742291_6258b980e9_c.jpg" width="800" />

</a></p>

<h2 id="connecting-o-s-install">Connecting, O/S install</h2>

<p>PC Engines APU board comes without a graphics adapter. I/O happens through serial port. I had to buy a USB adapter (that occasionally BSODs Windows 8) and guess what the correct settings are (parity, speed, etc). Furthermore, the settings could change through the boot process as the running software can change the configuration.</p>

<p>PC Engines provides a utility to create a bootable USB drive for updating the firmware. It works really well and requires no fiddling whatsover. The APU board serial rate is set to 115200 with the rest of values as default.</p>

<p>It&rsquo;s possible to use SD card, USB flash drive, mSATA or SATA for storage. I opted in for mSATA because SSDs are not that expensive anymore (especially the small 16GB kind), much faster than flash and more reliable.</p>

<p>I considered using MikroTik and other AP/router distributions. I could not get MikroTik to respond on serial no matter what settings I tried. I&rsquo;m glad it never worked because MikroTik is unnecessarily complex for my needs. It&rsquo;s an anti-thesis of the simplicity I&rsquo;m striving for.</p>

<p>My Linux distribution of choice is Gentoo. To install Gentoo I used a bootable Linux USB drive. Almost any live USB distribution works as long as it has basic command line tools. I did as little as I could on serial and enabled SSH as soon as possible. To enable serial it&rsquo;s important to add <strong>console=ttyS0,115200n8</strong> to the kernel boot arguments. That also applies for booting live distributions.</p>

<p>Since the router I had worked on is so similarly specced to the new access point build I made a shortcut in the install process. Instead of installing from scratch I copied an image of the existing disk. I&rsquo;ve then logged-in into the access point and changed settings.</p>

<p>The rest of the installation steps are left as an exercise to the reader. Joking aside, the official Gentoo installation documentation is sufficiently sharp to get a running system. I have included important configuration files at the end of the article.</p>

<h2 id="software-setup-hostapd-and-802-11ac-specifics">Software setup, hostapd and 802.11ac specifics</h2>

<p>Once the system boots we get to the interesting part of making the access point part of our access point build working. And there are a couple of important details.</p>

<h3 id="channels">Channels</h3>

<p>Radio channels were relatively simple to comprehend in the days of 802.11b/g 2.4Ghz spectrum. There are 11 20Mhz channels, of which 3 non-overlapping. The setup consist of choosing the channel which has least interference and least amount of users.</p>

<p>In 5Ghz spectrum things become more complicated. The channels vary in width: from 20 Mhz all the way up to 160 Mhz. There are several frequency ranges and these ranges are regulated. Regulations differ from country to country. It&rsquo;s not possible to choose just any channel. It is necessary to check which channels are allowed, which channels is the radio capable of and then decide based on busyness of the ether.</p>

<p>To check which channels are allowed by the regulations run <strong>iw reg get</strong>:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ap ~ <span class="c1"># iw reg get
</span><span class="c1"></span>country CH: DFS-UNSET
        <span class="o">(</span><span class="m">2402</span> - <span class="m">2482</span> @ <span class="m">40</span><span class="o">)</span>, <span class="o">(</span>N/A, <span class="m">20</span><span class="o">)</span>, <span class="o">(</span>N/A<span class="o">)</span>
        <span class="o">(</span><span class="m">5170</span> - <span class="m">5250</span> @ <span class="m">80</span><span class="o">)</span>, <span class="o">(</span>N/A, <span class="m">20</span><span class="o">)</span>, <span class="o">(</span>N/A<span class="o">)</span>
        <span class="o">(</span><span class="m">5250</span> - <span class="m">5330</span> @ <span class="m">80</span><span class="o">)</span>, <span class="o">(</span>N/A, <span class="m">20</span><span class="o">)</span>, <span class="o">(</span><span class="m">0</span> ms<span class="o">)</span>, DFS
        <span class="o">(</span><span class="m">5490</span> - <span class="m">5710</span> @ <span class="m">160</span><span class="o">)</span>, <span class="o">(</span>N/A, <span class="m">27</span><span class="o">)</span>, <span class="o">(</span><span class="m">0</span> ms<span class="o">)</span>, DFS
        <span class="o">(</span><span class="m">57000</span> - <span class="m">66000</span> @ <span class="m">2160</span><span class="o">)</span>, <span class="o">(</span>N/A, <span class="m">40</span><span class="o">)</span>, <span class="o">(</span>N/A<span class="o">)</span></code></pre></div>

<p>The output shows the regulation for Switzerland (CH) because I have previously set the country using <strong>iw reg set</strong> command:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ap ~ # iw reg <span class="nb">set</span> CH</code></pre></div>

<p>By the way, unless you change the domain to the country where you reside the radio will be restricted by the set of all countries. In reality this means that almost all channels will be out of bounds. I set the domain in a startup script.</p>

<p><strong>DFS</strong> is a technology that allows wireless to work on frequencies shared with weather radars and other systems on the same frequency bands. <strong>DFS</strong> makes the radio listen for pulses from those systems to prevent interference.</p>

<p>The channels supported by radio can be listed using <strong>iw list</strong>:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ap ~ <span class="c1"># iw list
</span><span class="c1"></span>...
                        * <span class="m">5180</span> MHz <span class="o">[</span><span class="m">36</span><span class="o">]</span> <span class="o">(</span><span class="m">17</span>.0 dBm<span class="o">)</span>
                        * <span class="m">5200</span> MHz <span class="o">[</span><span class="m">40</span><span class="o">]</span> <span class="o">(</span><span class="m">17</span>.0 dBm<span class="o">)</span>
                        * <span class="m">5220</span> MHz <span class="o">[</span><span class="m">44</span><span class="o">]</span> <span class="o">(</span><span class="m">17</span>.0 dBm<span class="o">)</span>
                        * <span class="m">5240</span> MHz <span class="o">[</span><span class="m">48</span><span class="o">]</span> <span class="o">(</span><span class="m">17</span>.0 dBm<span class="o">)</span>
                        * <span class="m">5260</span> MHz <span class="o">[</span><span class="m">52</span><span class="o">]</span> <span class="o">(</span><span class="m">20</span>.0 dBm<span class="o">)</span> <span class="o">(</span>no IR, radar detection<span class="o">)</span>
                          DFS state: usable <span class="o">(</span><span class="k">for</span> <span class="m">440</span> sec<span class="o">)</span>
                          DFS CAC time: <span class="m">60000</span> ms
                        * <span class="m">5280</span> MHz <span class="o">[</span><span class="m">56</span><span class="o">]</span> <span class="o">(</span><span class="m">20</span>.0 dBm<span class="o">)</span> <span class="o">(</span>no IR, radar detection<span class="o">)</span>
                          DFS state: usable <span class="o">(</span><span class="k">for</span> <span class="m">440</span> sec<span class="o">)</span>
                          DFS CAC time: <span class="m">60000</span> ms
                        * <span class="m">5300</span> MHz <span class="o">[</span><span class="m">60</span><span class="o">]</span> <span class="o">(</span><span class="m">20</span>.0 dBm<span class="o">)</span> <span class="o">(</span>no IR, radar detection<span class="o">)</span>
                          DFS state: usable <span class="o">(</span><span class="k">for</span> <span class="m">440</span> sec<span class="o">)</span>
                          DFS CAC time: <span class="m">60000</span> ms
                        * <span class="m">5320</span> MHz <span class="o">[</span><span class="m">64</span><span class="o">]</span> <span class="o">(</span><span class="m">20</span>.0 dBm<span class="o">)</span> <span class="o">(</span>no IR, radar detection<span class="o">)</span>
                          DFS state: usable <span class="o">(</span><span class="k">for</span> <span class="m">440</span> sec<span class="o">)</span>
                          DFS CAC time: <span class="m">60000</span> ms
                        * <span class="m">5500</span> MHz <span class="o">[</span><span class="m">100</span><span class="o">]</span> <span class="o">(</span>disabled<span class="o">)</span>
...
                        * <span class="m">5825</span> MHz <span class="o">[</span><span class="m">165</span><span class="o">]</span> <span class="o">(</span>disabled<span class="o">)</span>
...</code></pre></div>

<h3 id="radio-firmware">Radio firmware</h3>

<p>I&rsquo;m using Compex WLE900V5-23 radio that is based on Atheros AR9880 2.0 chipset. The support is available in kernel with <strong>ath10k</strong> module. However, the required firmware is not shipped with <strong>linux-firmware</strong> package yet so it&rsquo;s required to manually download the firmware and put it into the kernel source tree.</p>

<p>I&rsquo;ve obtained the firmware from <a href="https://github.com/kvalo/ath10k-firmware.git">ath10k git repository</a>. I&rsquo;ve then placed the <strong>ath10k</strong> directory in <strong>firmware</strong> directory in the kernel source tree. Finally, I&rsquo;ve changed the following kernel settings to build the firmware into the kernel:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">CONFIG_FIRMWARE_IN_KERNEL</span><span class="o">=</span>y
<span class="nv">CONFIG_EXTRA_FIRMWARE</span><span class="o">=</span><span class="s2">&#34;ath10k/QCA988X/hw2.0/firmware-2.bin ath10k/QCA988X/hw2.0/board.bin&#34;</span>
<span class="nv">CONFIG_EXTRA_FIRMWARE_DIR</span><span class="o">=</span><span class="s2">&#34;firmware&#34;</span></code></pre></div>

<h3 id="network-setup-and-hostapd">Network setup and hostapd</h3>

<p>I&rsquo;ve configured the new access point to work as a bridge. It does not do any routing. The access point makes the wired connection available to wireless clients.</p>

<p>I&rsquo;m using OpenRC. Configuration in <strong>/etc/conf.d/net</strong> is very simple. There is a bridge configuration linked to the wired interface:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ap linux <span class="c1"># cat /etc/conf.d/net
</span><span class="c1"></span>
<span class="nv">dns_domain_lo</span><span class="o">=</span><span class="s2">&#34;bethania&#34;</span>
<span class="nv">dns_search</span><span class="o">=</span><span class="s2">&#34;bethania&#34;</span>

<span class="c1"># AP bridge setup
</span><span class="c1"></span><span class="nv">config_enp1s0</span><span class="o">=</span><span class="s2">&#34;null&#34;</span>
<span class="nv">bridge_br0</span><span class="o">=</span><span class="s2">&#34;enp1s0&#34;</span>
<span class="nv">rc_net_br0</span><span class="o">=</span><span class="s2">&#34;net.enp1s0&#34;</span>
<span class="nv">config_br0</span><span class="o">=</span><span class="s2">&#34;192.168.69.2/24&#34;</span>
<span class="nv">routes_br0</span><span class="o">=</span><span class="s2">&#34;default via 192.168.69.1&#34;</span>
<span class="nv">dns_servers_br0</span><span class="o">=</span><span class="s2">&#34;192.168.69.1&#34;</span></code></pre></div>

<p>Configuration of the hostapd init script:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ap linux <span class="c1"># cat /etc/conf.d/hostapd
</span><span class="c1"></span>
<span class="nv">INTERFACES</span><span class="o">=</span><span class="s2">&#34;br0&#34;</span>
<span class="nv">CONFIGS</span><span class="o">=</span><span class="s2">&#34;/etc/hostapd/hostapd.conf&#34;</span>
<span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&#34;&#34;</span></code></pre></div>

<p><strong>hostapd</strong> configuration describes capabilities of the radio and sets up the frequencies, security and useful features. For example, to use wireless on <strong>DFS</strong> controlled frequencies it is required to enable <strong>ieee80211d</strong> and <strong>ieee80211h</strong> settings. Here&rsquo;s a working and tested 802.11ac setup that I&rsquo;m using right now:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ap linux <span class="c1"># cat /etc/hostapd/hostapd.conf
</span><span class="c1"></span>
<span class="c1">### hostapd configuration file
</span><span class="c1"></span><span class="nv">ctrl_interface</span><span class="o">=</span>/var/run/hostapd
<span class="nv">ctrl_interface_group</span><span class="o">=</span><span class="m">0</span>
<span class="nv">interface</span><span class="o">=</span>wlp4s0
<span class="nv">driver</span><span class="o">=</span>nl80211
<span class="nv">bridge</span><span class="o">=</span>br0

<span class="c1">### IEEE 802.11
</span><span class="c1"></span><span class="nv">ssid</span><span class="o">=</span>bethaniaven9
<span class="nv">hw_mode</span><span class="o">=</span>a
<span class="nv">channel</span><span class="o">=</span><span class="m">52</span>
<span class="nv">max_num_sta</span><span class="o">=</span><span class="m">128</span>
<span class="nv">auth_algs</span><span class="o">=</span><span class="m">1</span>

<span class="c1">### DFS
</span><span class="c1"></span><span class="nv">country_code</span><span class="o">=</span>CH
<span class="nv">ieee80211d</span><span class="o">=</span><span class="m">1</span>
<span class="nv">ieee80211h</span><span class="o">=</span><span class="m">1</span>

<span class="c1">### IEEE 802.11n
</span><span class="c1"></span><span class="nv">ieee80211n</span><span class="o">=</span><span class="m">1</span>
<span class="nv">ht_capab</span><span class="o">=[</span>HT40+<span class="o">][</span>LDPC<span class="o">][</span>SHORT-GI-20<span class="o">][</span>SHORT-GI-40<span class="o">][</span>TX-STBC<span class="o">][</span>RX-STBC1<span class="o">][</span>DSSS_CCK-40<span class="o">]</span>

<span class="c1">### IEEE 802.11ac
</span><span class="c1"></span><span class="nv">ieee80211ac</span><span class="o">=</span><span class="m">1</span>
<span class="nv">vht_oper_chwidth</span><span class="o">=</span><span class="m">1</span>
<span class="nv">vht_capab</span><span class="o">=[</span>MAX-MPDU-11454<span class="o">][</span>RXLDPC<span class="o">][</span>SHORT-GI-80<span class="o">][</span>TX-STBC-2BY1<span class="o">][</span>RX-STBC-1<span class="o">]</span>
<span class="nv">vht_oper_centr_freq_seg0_idx</span><span class="o">=</span><span class="m">62</span>

<span class="c1">### IEEE 802.11i
</span><span class="c1"></span><span class="nv">wpa</span><span class="o">=</span><span class="m">2</span>
<span class="nv">wpa_key_mgmt</span><span class="o">=</span>WPA-PSK
<span class="nv">wpa_passphrase</span><span class="o">=</span>XXX
<span class="nv">rsn_pairwise</span><span class="o">=</span>CCMP

<span class="c1">### hostapd event logger
</span><span class="c1"></span><span class="nv">logger_syslog</span><span class="o">=</span>-1
<span class="nv">logger_syslog_level</span><span class="o">=</span><span class="m">2</span>
<span class="nv">logger_stdout</span><span class="o">=</span>-1
<span class="nv">logger_stdout_level</span><span class="o">=</span><span class="m">2</span>

<span class="c1">### WMM
</span><span class="c1"></span><span class="nv">wmm_enabled</span><span class="o">=</span><span class="m">1</span>
<span class="nv">uapsd_advertisement_enabled</span><span class="o">=</span><span class="m">1</span>
<span class="nv">wmm_ac_bk_cwmin</span><span class="o">=</span><span class="m">4</span>
<span class="nv">wmm_ac_bk_cwmax</span><span class="o">=</span><span class="m">10</span>
<span class="nv">wmm_ac_bk_aifs</span><span class="o">=</span><span class="m">7</span>
<span class="nv">wmm_ac_bk_txop_limit</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_ac_bk_acm</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_ac_be_aifs</span><span class="o">=</span><span class="m">3</span>
<span class="nv">wmm_ac_be_cwmin</span><span class="o">=</span><span class="m">4</span>
<span class="nv">wmm_ac_be_cwmax</span><span class="o">=</span><span class="m">10</span>
<span class="nv">wmm_ac_be_txop_limit</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_ac_be_acm</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_ac_vi_aifs</span><span class="o">=</span><span class="m">2</span>
<span class="nv">wmm_ac_vi_cwmin</span><span class="o">=</span><span class="m">3</span>
<span class="nv">wmm_ac_vi_cwmax</span><span class="o">=</span><span class="m">4</span>
<span class="nv">wmm_ac_vi_txop_limit</span><span class="o">=</span><span class="m">94</span>
<span class="nv">wmm_ac_vi_acm</span><span class="o">=</span><span class="m">0</span>
<span class="nv">wmm_ac_vo_aifs</span><span class="o">=</span><span class="m">2</span>
<span class="nv">wmm_ac_vo_cwmin</span><span class="o">=</span><span class="m">2</span>
<span class="nv">wmm_ac_vo_cwmax</span><span class="o">=</span><span class="m">3</span>
<span class="nv">wmm_ac_vo_txop_limit</span><span class="o">=</span><span class="m">47</span>
<span class="nv">wmm_ac_vo_acm</span><span class="o">=</span><span class="m">0</span>

<span class="c1">### TX queue parameters
</span><span class="c1"></span><span class="nv">tx_queue_data3_aifs</span><span class="o">=</span><span class="m">7</span>
<span class="nv">tx_queue_data3_cwmin</span><span class="o">=</span><span class="m">15</span>
<span class="nv">tx_queue_data3_cwmax</span><span class="o">=</span><span class="m">1023</span>
<span class="nv">tx_queue_data3_burst</span><span class="o">=</span><span class="m">0</span>
<span class="nv">tx_queue_data2_aifs</span><span class="o">=</span><span class="m">3</span>
<span class="nv">tx_queue_data2_cwmin</span><span class="o">=</span><span class="m">15</span>
<span class="nv">tx_queue_data2_cwmax</span><span class="o">=</span><span class="m">63</span>
<span class="nv">tx_queue_data2_burst</span><span class="o">=</span><span class="m">0</span>
<span class="nv">tx_queue_data1_aifs</span><span class="o">=</span><span class="m">1</span>
<span class="nv">tx_queue_data1_cwmin</span><span class="o">=</span><span class="m">7</span>
<span class="nv">tx_queue_data1_cwmax</span><span class="o">=</span><span class="m">15</span>
<span class="nv">tx_queue_data1_burst</span><span class="o">=</span><span class="m">3</span>.0
<span class="nv">tx_queue_data0_aifs</span><span class="o">=</span><span class="m">1</span>
<span class="nv">tx_queue_data0_cwmin</span><span class="o">=</span><span class="m">3</span>
<span class="nv">tx_queue_data0_cwmax</span><span class="o">=</span><span class="m">7</span>
<span class="nv">tx_queue_data0_burst</span><span class="o">=</span><span class="m">1</span>.5</code></pre></div>

<h2 id="final-words-and-config-files">Final words and config files</h2>

<p>Once hostapd is running it&rsquo;s important to measure transfer rates. The first time I ran hostapd I was getting 802.11b speed. After a day of experimenting and reading through mailing list discussions I arrived at a configuration that yields 60 MB/s (480Mbit) real world samba transfer speed! I&rsquo;m genuinely impressed as it&rsquo;s more than 2X faster than the existing 802.11n setup that I currently have.</p>

<p>List of configuration files that you might find useful:</p>

<ul>
<li><p><a href="/files/80211ac/kernel_config">Linux kernel .config</a></p></li>

<li><p><a href="/files/80211ac/make.conf">portage make.conf</a></p></li>

<li><p><a href="/files/80211ac/package.keywords">portage keywords</a></p></li>

<li><p><a href="/files/80211ac/package.use">portage use</a></p></li>

<li><p><a href="/files/80211ac/portage_world">portage /var/lib/portage/world</a></p></li>

<li><p><a href="/files/80211ac/hostapd.conf">hostapd.conf</a></p></li>

<li><p><a href="/files/80211ac/hostapd">/etc/conf.d/hostapd</a></p></li>

<li><p><a href="/files/80211ac/net">/etc/conf.d/net</a></p></li>

<li><p><a href="/files/80211ac/lspci">lspci output</a></p></li>

<li><p><a href="/files/80211ac/iw_list">iw list output</a></p></li>
</ul>

<p>The fully assembled access point in flesh:</p>

<p><a href="https://www.flickr.com/photos/tentaclephotos/16390542446/"><img src="https://farm8.staticflickr.com/7359/16390542446_e290a3ca08_c.jpg" width="800" />

</a></p>
      </article>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="http://pisarenko.net/blog/2015/01/25/motorcycle-adventure-in-norway/" data-toggle="tooltip" data-placement="top" title="Motorcycle adventure in Norway">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="http://pisarenko.net/blog/2015/03/03/the-problems-i-dont-have/" data-toggle="tooltip" data-placement="top" title="The problems I don&#39;t have">Next Post &rarr;</a>
          </li>
        
      </ul>

      
        
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "drseergio" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://github.com/pisarenko-net" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="http://pisarenko.net/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          Sergey Pisarenko
          &nbsp;&bull;&nbsp;
          2018

          
            &nbsp;&bull;&nbsp;
            <a href="http://pisarenko.net/">Sergey Pisarenko</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="http://pisarenko.net/js/main.js"></script>
<script src="http://pisarenko.net/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>






<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45212877-1', 'auto');
ga('send', 'pageview');
</script>


  </body>
</html>

